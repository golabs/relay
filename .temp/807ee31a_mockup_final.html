<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RELAY - Aurora Cyberpunk Final</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* =====================================================
           RELAY - AURORA CYBERPUNK FINAL
           Variation C aurora + Variation A cyberpunk panels
           + Variation B polish
           ===================================================== */

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --aurora-purple: #7b2fbe;
            --aurora-teal: #0fbcb6;
            --aurora-blue: #0a1628;
            --aurora-pink: #e84393;
            --aurora-magenta: #4a0028;
            --aurora-deep: #0a0a1a;
            --aurora-cyan: #00cec9;
            --aurora-deep-purple: #1a0533;
            --aurora-electric-teal: #0a4d4d;
            --aurora-midnight: #0a1628;
            --aurora-warm-magenta: #4a0028;
            --aurora-dark-cyan: #003344;
            --glass-bg: rgba(10, 10, 30, 0.4);
            --glass-bg-hover: rgba(15, 15, 45, 0.55);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-border-hover: rgba(255, 255, 255, 0.18);
            --text-primary: #e8ecf4;
            --text-secondary: rgba(200, 210, 230, 0.55);
            --text-bright: #ffffff;
            --cyan: #00f0ff;
            --cyan-glow: rgba(0, 240, 255, 0.35);
            --magenta: #ff00aa;
            --magenta-glow: rgba(255, 0, 170, 0.3);
            --green: #00ff88;
            --green-glow: rgba(0, 255, 136, 0.3);
            --teal: #0fbcb6;
            --purple: #a855f7;
            --border-glow-cyan: rgba(0, 240, 255, 0.2);
            --border-glow-magenta: rgba(255, 0, 170, 0.15);
        }

        html, body {
            height: 100%;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-primary);
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* ===== ANIMATED AURORA BACKGROUND ===== */
        body {
            background: var(--aurora-deep);
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: -60%;
            left: -60%;
            width: 220%;
            height: 220%;
            background: linear-gradient(
                45deg,
                #0a0a1a 0%,
                #1a0533 8%,
                #0d1e38 14%,
                #0a4d4d 20%,
                #003344 26%,
                #0a1628 32%,
                #1a0533 38%,
                #4a0028 44%,
                #0a0a1a 50%,
                #003344 56%,
                #0a4d4d 62%,
                #0a1628 68%,
                #1a0533 74%,
                #4a0028 80%,
                #003344 86%,
                #0a1628 92%,
                #0a0a1a 100%
            );
            background-size: 500% 500%;
            animation: auroraShift 28s ease-in-out infinite;
            z-index: 0;
            opacity: 0.9;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse 80% 50% at 20% 20%, rgba(123, 47, 190, 0.25) 0%, transparent 70%),
                radial-gradient(ellipse 60% 70% at 80% 80%, rgba(0, 206, 201, 0.2) 0%, transparent 60%),
                radial-gradient(ellipse 50% 40% at 50% 50%, rgba(74, 0, 40, 0.2) 0%, transparent 65%),
                radial-gradient(ellipse 90% 30% at 70% 10%, rgba(0, 51, 68, 0.3) 0%, transparent 50%);
            z-index: 0;
            animation: radialPulse 15s ease-in-out infinite alternate;
        }

        @keyframes auroraShift {
            0% { background-position: 0% 0%; }
            25% { background-position: 50% 100%; }
            50% { background-position: 100% 50%; }
            75% { background-position: 50% 0%; }
            100% { background-position: 0% 0%; }
        }

        @keyframes radialPulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        /* ===== SCANLINE OVERLAY ===== */
        .scanline-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.025) 2px,
                rgba(0, 0, 0, 0.025) 4px
            );
            z-index: 9999;
            pointer-events: none;
        }

        /* ===== SCROLLBARS ===== */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--aurora-teal), var(--aurora-purple), var(--aurora-pink));
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--cyan), var(--purple), var(--magenta));
        }
        * { scrollbar-width: thin; scrollbar-color: rgba(0, 240, 255, 0.3) transparent; }

        /* ===== APP LAYOUT ===== */
        .app {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== GLASS MORPHISM MIXIN ===== */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(1.4);
            -webkit-backdrop-filter: blur(20px) saturate(1.4);
            border: 1px solid var(--glass-border);
            position: relative;
        }
        .glass:hover {
            filter: brightness(1.06);
        }

        /* ===== CORNER ACCENTS (HUD style) ===== */
        .hud-corners {
            position: relative;
        }
        .hud-corners::before,
        .hud-corners::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            pointer-events: none;
            z-index: 5;
        }
        .hud-corners::before {
            top: -1px; left: -1px;
            border-top: 2px solid var(--cyan);
            border-left: 2px solid var(--cyan);
        }
        .hud-corners::after {
            top: -1px; right: -1px;
            border-top: 2px solid var(--magenta);
            border-right: 2px solid var(--magenta);
        }
        .hud-corners-bottom {
            position: relative;
        }
        .hud-corners-bottom .corner-bl,
        .hud-corners-bottom .corner-br {
            position: absolute;
            width: 12px;
            height: 12px;
            pointer-events: none;
            z-index: 5;
        }
        .hud-corners-bottom .corner-bl {
            bottom: -1px; left: -1px;
            border-bottom: 2px solid var(--magenta);
            border-left: 2px solid var(--magenta);
        }
        .hud-corners-bottom .corner-br {
            bottom: -1px; right: -1px;
            border-bottom: 2px solid var(--cyan);
            border-right: 2px solid var(--cyan);
        }

        /* ===== ANIMATED GRADIENT BORDER ===== */
        .gradient-border::before {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: inherit;
            padding: 1px;
            background: linear-gradient(
                var(--gradient-angle, 0deg),
                var(--cyan) 0%,
                var(--aurora-purple) 25%,
                var(--magenta) 50%,
                var(--aurora-teal) 75%,
                var(--cyan) 100%
            );
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: borderRotate 6s linear infinite;
            pointer-events: none;
            z-index: 2;
            opacity: 0.5;
        }

        @property --gradient-angle {
            syntax: '<angle>';
            initial-value: 0deg;
            inherits: false;
        }
        @keyframes borderRotate {
            to { --gradient-angle: 360deg; }
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            align-items: center;
            padding: 0 16px;
            height: 48px;
            background: rgba(10, 10, 30, 0.6);
            backdrop-filter: blur(24px) saturate(1.5);
            -webkit-backdrop-filter: blur(24px) saturate(1.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            flex-shrink: 0;
            z-index: 100;
            position: relative;
            overflow: hidden;
        }

        /* Header sweep shine */
        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(0, 240, 255, 0.04) 30%,
                rgba(168, 85, 247, 0.06) 50%,
                rgba(255, 0, 170, 0.04) 70%,
                transparent 100%
            );
            animation: headerSweep 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes headerSweep {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        .header-title {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 3px;
            background: linear-gradient(135deg, var(--aurora-purple), var(--cyan), var(--aurora-purple));
            background-size: 200% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGradient 4s ease infinite;
            margin-right: 20px;
            text-shadow: none;
            flex-shrink: 0;
        }

        @keyframes titleGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .header-center {
            display: flex;
            gap: 6px;
            margin-right: auto;
        }

        .workflow-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 5px 14px;
            font-size: 12px;
            font-weight: 500;
            font-family: inherit;
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .workflow-btn:hover {
            color: var(--text-bright);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 240, 255, 0.3);
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.15), inset 0 0 15px rgba(0, 240, 255, 0.05);
        }

        .step-num {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            font-size: 10px;
            font-weight: 700;
            border-radius: 50%;
            background: rgba(0, 240, 255, 0.15);
            color: var(--cyan);
            flex-shrink: 0;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .health-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-right: 8px;
        }

        .health-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green);
            box-shadow: 0 0 8px var(--green-glow), 0 0 16px var(--green-glow);
            animation: healthPulse 2s ease-in-out infinite;
        }

        @keyframes healthPulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 6px var(--green-glow); }
            50% { opacity: 0.7; box-shadow: 0 0 12px var(--green-glow), 0 0 20px var(--green-glow); }
        }

        .health-text {
            font-size: 11px;
            color: var(--green);
            font-weight: 500;
        }

        .project-select {
            padding: 4px 10px;
            font-size: 11px;
            font-family: inherit;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            cursor: pointer;
            outline: none;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .project-select:hover {
            border-color: rgba(0, 240, 255, 0.3);
        }
        .project-select option {
            background: #1a1a2e;
            color: var(--text-primary);
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .icon-btn:hover {
            color: var(--text-bright);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 240, 255, 0.3);
            box-shadow: inset 0 0 12px rgba(0, 240, 255, 0.1), 0 0 10px rgba(0, 240, 255, 0.1);
        }
        .icon-btn.primary {
            background: rgba(0, 240, 255, 0.1);
            border-color: rgba(0, 240, 255, 0.25);
            color: var(--cyan);
        }
        .icon-btn.primary:hover {
            background: rgba(0, 240, 255, 0.2);
            box-shadow: 0 0 16px rgba(0, 240, 255, 0.3), inset 0 0 12px rgba(0, 240, 255, 0.1);
        }

        /* ===== ACK BANNER ===== */
        .ack-banner {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 16px;
            background: rgba(10, 10, 30, 0.5);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 12px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .ack-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--aurora-teal);
            box-shadow: 0 0 8px var(--aurora-teal);
            animation: ackPulse 1.5s ease-in-out infinite;
        }

        @keyframes ackPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        .ack-text {
            color: var(--aurora-teal);
            font-weight: 500;
        }

        /* ===== MAIN LAYOUT ===== */
        .main {
            display: flex;
            flex: 1;
            overflow: hidden;
            gap: 8px;
            padding: 8px;
        }

        /* ===== HISTORY SIDEBAR ===== */
        .history-sidebar {
            width: 240px;
            min-width: 240px;
            display: flex;
            flex-direction: column;
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(1.4);
            -webkit-backdrop-filter: blur(20px) saturate(1.4);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            animation: panelFadeIn 0.6s ease-out;
        }

        @keyframes panelFadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pane-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            flex-shrink: 0;
        }

        .pane-title {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text-secondary);
            text-shadow: 0 0 12px rgba(0, 240, 255, 0.2);
        }

        .pane-title span {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .pane-controls {
            display: flex;
            gap: 4px;
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .history-item {
            display: flex;
            flex-direction: column;
            padding: 10px 12px;
            margin-bottom: 4px;
            border-radius: 8px;
            cursor: pointer;
            border-left: 3px solid transparent;
            background: rgba(255, 255, 255, 0.02);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: historyFadeIn 0.5s ease-out backwards;
        }

        .history-item:nth-child(1) { animation-delay: 0.05s; }
        .history-item:nth-child(2) { animation-delay: 0.1s; }
        .history-item:nth-child(3) { animation-delay: 0.15s; }
        .history-item:nth-child(4) { animation-delay: 0.2s; }
        .history-item:nth-child(5) { animation-delay: 0.25s; }
        .history-item:nth-child(6) { animation-delay: 0.3s; }
        .history-item:nth-child(7) { animation-delay: 0.35s; }
        .history-item:nth-child(8) { animation-delay: 0.4s; }

        @keyframes historyFadeIn {
            from { opacity: 0; transform: translateX(-12px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .history-item.active {
            background: rgba(0, 240, 255, 0.06);
            border-left-color: var(--cyan);
            box-shadow: 0 0 12px rgba(0, 240, 255, 0.08);
        }

        .history-item.accent-teal { border-left-color: var(--aurora-teal); }
        .history-item.accent-purple { border-left-color: var(--aurora-purple); }
        .history-item.accent-pink { border-left-color: var(--aurora-pink); }
        .history-item.accent-cyan { border-left-color: var(--cyan); }
        .history-item.accent-green { border-left-color: var(--green); }

        .history-title {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 3px;
        }

        .history-time {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .history-count {
            padding: 8px 14px;
            font-size: 10px;
            color: var(--text-secondary);
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* ===== PANE (shared panel styles) ===== */
        .pane {
            display: flex;
            flex-direction: column;
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(1.4);
            -webkit-backdrop-filter: blur(20px) saturate(1.4);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        /* ===== AXION (response) PANE ===== */
        .response-pane {
            flex: 1;
            animation: panelFadeIn 0.6s ease-out 0.1s backwards;
        }

        .axion-title-area {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pane-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            display: flex;
            flex-direction: column;
        }

        /* ===== LIVE ACTIVITY BOX ===== */
        .live-activity-box {
            background: rgba(10, 15, 30, 0.5);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 12px 14px;
            margin-bottom: 12px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        /* Animated aurora border for live box */
        .live-activity-box::before {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: inherit;
            padding: 1px;
            background: linear-gradient(
                var(--gradient-angle, 0deg),
                var(--cyan) 0%,
                var(--aurora-purple) 33%,
                var(--magenta) 66%,
                var(--cyan) 100%
            );
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: borderRotate 4s linear infinite;
            pointer-events: none;
            opacity: 0.6;
        }

        /* Scanning line effect */
        .live-activity-box::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(0, 240, 255, 0.04) 40%,
                rgba(0, 240, 255, 0.08) 50%,
                rgba(0, 240, 255, 0.04) 60%,
                transparent 100%
            );
            animation: scanLine 3s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes scanLine {
            0% { left: -50%; }
            100% { left: 150%; }
        }

        .live-activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .live-indicator {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1.5px;
            color: var(--green);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .live-indicator::before {
            content: '';
            display: inline-block;
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: var(--green);
            box-shadow: 0 0 6px var(--green), 0 0 14px var(--green-glow);
            animation: livePulse 1.2s ease-in-out infinite;
        }

        @keyframes livePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.3); }
        }

        .live-status {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .live-activity-content {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .live-activity-content .tool-call {
            color: var(--aurora-teal);
            font-weight: 500;
        }

        /* Voice Visualizer */
        .voice-visualizer {
            display: flex;
            align-items: flex-end;
            gap: 3px;
            height: 24px;
            position: relative;
            z-index: 1;
        }

        .voice-bar {
            width: 4px;
            border-radius: 2px;
            min-height: 3px;
            animation: barBounce var(--duration, 1s) ease-in-out infinite;
        }

        .voice-bar:nth-child(1) { background: var(--aurora-purple); --duration: 0.8s; height: 8px; }
        .voice-bar:nth-child(2) { background: var(--aurora-teal); --duration: 1.1s; height: 16px; animation-delay: 0.1s; }
        .voice-bar:nth-child(3) { background: var(--cyan); --duration: 0.7s; height: 22px; animation-delay: 0.2s; }
        .voice-bar:nth-child(4) { background: var(--aurora-pink); --duration: 0.9s; height: 14px; animation-delay: 0.15s; }
        .voice-bar:nth-child(5) { background: var(--aurora-purple); --duration: 1.3s; height: 18px; animation-delay: 0.3s; }
        .voice-bar:nth-child(6) { background: var(--aurora-teal); --duration: 0.85s; height: 10px; animation-delay: 0.05s; }
        .voice-bar:nth-child(7) { background: var(--magenta); --duration: 1.05s; height: 20px; animation-delay: 0.25s; }

        @keyframes barBounce {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        /* ===== MESSAGE BUBBLES ===== */
        .message {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px 14px;
            margin-bottom: 10px;
            border-left: 3px solid var(--aurora-teal);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .message:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .message.user {
            border-left-color: var(--aurora-teal);
        }

        .message.assistant {
            border-left-color: var(--aurora-purple);
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .message-sender {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .message-sender.user-name {
            color: var(--aurora-teal);
            text-shadow: 0 0 10px rgba(15, 188, 182, 0.3);
        }

        .message-sender.ai-name {
            color: var(--aurora-purple);
            text-shadow: 0 0 10px rgba(123, 47, 190, 0.3);
        }

        .message-time {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .message-body {
            font-size: 13px;
            line-height: 1.65;
            color: var(--text-primary);
        }

        .message-body p {
            margin-bottom: 8px;
        }
        .message-body p:last-child {
            margin-bottom: 0;
        }

        /* Code blocks */
        .code-block {
            background: rgba(10, 10, 30, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            font-family: 'Menlo', 'Consolas', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            overflow-x: auto;
            position: relative;
        }

        .code-block .code-lang {
            position: absolute;
            top: 6px;
            right: 10px;
            font-size: 9px;
            font-weight: 600;
            letter-spacing: 1px;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-family: 'Inter', sans-serif;
        }

        .code-keyword { color: var(--magenta); }
        .code-string { color: var(--green); }
        .code-function { color: var(--cyan); }
        .code-comment { color: var(--text-secondary); font-style: italic; }
        .code-variable { color: var(--aurora-teal); }
        .code-type { color: var(--aurora-purple); }
        .code-number { color: #f0a050; }
        .code-bracket { color: var(--text-secondary); }

        /* ===== BRETT (input) PANE ===== */
        .input-pane {
            width: 35%;
            min-width: 300px;
            animation: panelFadeIn 0.6s ease-out 0.2s backwards;
        }

        .input-pane .pane-header {
            flex-wrap: wrap;
        }

        .input-pane .pane-controls {
            flex-wrap: wrap;
        }

        .input-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .line-numbers {
            width: 36px;
            padding: 10px 6px;
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-secondary);
            font-family: 'Menlo', 'Consolas', monospace;
            font-size: 11px;
            line-height: 1.65;
            text-align: right;
            user-select: none;
            overflow: hidden;
            border-right: 1px solid rgba(255, 255, 255, 0.04);
            flex-shrink: 0;
        }

        .input-area {
            flex: 1;
            padding: 10px 12px;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-primary);
            font-family: 'Menlo', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.65;
            resize: none;
            overflow-y: auto;
        }

        .input-area::placeholder {
            color: var(--text-secondary);
        }

        .shortcut-hint {
            padding: 6px 14px;
            font-size: 10px;
            color: var(--text-secondary);
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.04);
            flex-shrink: 0;
        }
        .shortcut-hint kbd {
            padding: 1px 5px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            font-family: inherit;
            font-size: 10px;
        }

        /* ===== SEND BUTTON SPECIAL ===== */
        .send-btn {
            position: relative;
            background: rgba(0, 240, 255, 0.15);
            border: 1px solid rgba(0, 240, 255, 0.3);
            color: var(--cyan);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .send-btn::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 11px;
            border: 1px solid var(--cyan);
            opacity: 0;
            animation: sendPulseRing 2s ease-in-out infinite;
        }

        @keyframes sendPulseRing {
            0%, 100% { opacity: 0; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(1.1); }
        }

        .send-btn:hover {
            background: rgba(0, 240, 255, 0.25);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.4), 0 0 40px rgba(0, 240, 255, 0.15), inset 0 0 15px rgba(0, 240, 255, 0.15);
            transform: scale(1.05);
        }

        .send-btn:hover::before {
            animation: none;
            opacity: 0.6;
            transform: scale(1.15);
        }

        /* ===== QUEUE PANEL ===== */
        .queue-panel {
            position: fixed;
            bottom: 40px;
            right: 16px;
            width: 260px;
            background: rgba(10, 10, 30, 0.6);
            backdrop-filter: blur(20px) saturate(1.4);
            -webkit-backdrop-filter: blur(20px) saturate(1.4);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            z-index: 50;
            overflow: hidden;
            animation: panelFadeIn 0.5s ease-out;
        }

        .queue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .queue-title {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .queue-clear {
            font-size: 10px;
            padding: 3px 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 4px;
            color: var(--text-secondary);
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .queue-clear:hover {
            background: rgba(255, 0, 100, 0.15);
            border-color: rgba(255, 0, 100, 0.3);
            color: #ff6b9d;
        }

        .queue-list {
            padding: 8px;
        }

        .queue-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            margin-bottom: 4px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.03);
            font-size: 11px;
            color: var(--text-secondary);
        }

        .queue-item-dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .queue-item-dot.pending { background: #f0a050; box-shadow: 0 0 6px rgba(240, 160, 80, 0.3); }
        .queue-item-dot.waiting { background: var(--aurora-teal); box-shadow: 0 0 6px rgba(15, 188, 182, 0.3); }

        .queue-item-text {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .queue-item-time {
            font-size: 9px;
            color: rgba(200, 210, 230, 0.35);
            flex-shrink: 0;
        }

        /* ===== SHORTCUTS BAR ===== */
        .shortcuts-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 4px 12px;
            background: rgba(10, 10, 30, 0.4);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255, 255, 255, 0.04);
            font-size: 10px;
            color: var(--text-secondary);
            flex-shrink: 0;
            z-index: 10;
        }

        .shortcuts-bar kbd {
            padding: 1px 5px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            font-family: inherit;
            font-size: 10px;
            color: var(--text-primary);
        }

        /* ===== INNER GLOW for panels ===== */
        .pane::after,
        .history-sidebar::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04), inset 0 0 20px rgba(0, 240, 255, 0.02);
            pointer-events: none;
            z-index: 1;
        }

        /* ===== UTILITY ===== */
        .separator {
            width: 1px;
            height: 20px;
            background: rgba(255, 255, 255, 0.08);
            margin: 0 4px;
        }
    </style>
</head>
<body>

<!-- SVG PARTICLE SYSTEM -->
<svg class="particle-system" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;opacity:0.6;">
    <circle cx="10%" cy="90%" r="1.5" fill="#7b2fbe" opacity="0.5">
        <animate attributeName="cy" from="100%" to="-5%" dur="22s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="10%;14%;8%;10%" dur="22s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.5;0.8;0.4;0.5" dur="6s" repeatCount="indefinite"/>
    </circle>
    <circle cx="25%" cy="95%" r="2" fill="#0fbcb6" opacity="0.4">
        <animate attributeName="cy" from="105%" to="-5%" dur="18s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="25%;28%;22%;25%" dur="18s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.4;0.7;0.3;0.4" dur="5s" repeatCount="indefinite"/>
    </circle>
    <circle cx="40%" cy="100%" r="1" fill="#e84393" opacity="0.6">
        <animate attributeName="cy" from="100%" to="-5%" dur="26s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="40%;42%;38%;40%" dur="26s" repeatCount="indefinite"/>
    </circle>
    <circle cx="55%" cy="92%" r="2.5" fill="#00cec9" opacity="0.35">
        <animate attributeName="cy" from="102%" to="-8%" dur="20s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="55%;58%;52%;55%" dur="20s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.35;0.65;0.25;0.35" dur="7s" repeatCount="indefinite"/>
    </circle>
    <circle cx="70%" cy="88%" r="1.2" fill="#7b2fbe" opacity="0.45">
        <animate attributeName="cy" from="98%" to="-5%" dur="24s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="70%;73%;67%;70%" dur="24s" repeatCount="indefinite"/>
    </circle>
    <circle cx="85%" cy="96%" r="1.8" fill="#ff00aa" opacity="0.3">
        <animate attributeName="cy" from="106%" to="-5%" dur="16s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="85%;88%;82%;85%" dur="16s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.3;0.55;0.2;0.3" dur="5.5s" repeatCount="indefinite"/>
    </circle>
    <circle cx="15%" cy="85%" r="1" fill="#00f0ff" opacity="0.5">
        <animate attributeName="cy" from="95%" to="-5%" dur="28s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="15%;18%;12%;15%" dur="28s" repeatCount="indefinite"/>
    </circle>
    <circle cx="33%" cy="91%" r="2" fill="#0fbcb6" opacity="0.4">
        <animate attributeName="cy" from="101%" to="-5%" dur="19s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="33%;36%;30%;33%" dur="19s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.4;0.65;0.3;0.4" dur="6.5s" repeatCount="indefinite"/>
    </circle>
    <circle cx="48%" cy="94%" r="1.5" fill="#e84393" opacity="0.35">
        <animate attributeName="cy" from="104%" to="-5%" dur="21s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="48%;50%;46%;48%" dur="21s" repeatCount="indefinite"/>
    </circle>
    <circle cx="62%" cy="97%" r="2.2" fill="#7b2fbe" opacity="0.4">
        <animate attributeName="cy" from="107%" to="-5%" dur="25s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="62%;65%;59%;62%" dur="25s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.4;0.6;0.25;0.4" dur="8s" repeatCount="indefinite"/>
    </circle>
    <circle cx="78%" cy="89%" r="1.3" fill="#00cec9" opacity="0.5">
        <animate attributeName="cy" from="99%" to="-5%" dur="17s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="78%;80%;76%;78%" dur="17s" repeatCount="indefinite"/>
    </circle>
    <circle cx="92%" cy="93%" r="1" fill="#ff00aa" opacity="0.4">
        <animate attributeName="cy" from="103%" to="-5%" dur="23s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="92%;94%;90%;92%" dur="23s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.4;0.7;0.3;0.4" dur="5s" repeatCount="indefinite"/>
    </circle>
    <circle cx="5%" cy="87%" r="2" fill="#00f0ff" opacity="0.3">
        <animate attributeName="cy" from="97%" to="-5%" dur="27s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="5%;8%;3%;5%" dur="27s" repeatCount="indefinite"/>
    </circle>
    <circle cx="20%" cy="99%" r="1.5" fill="#e84393" opacity="0.5">
        <animate attributeName="cy" from="109%" to="-5%" dur="15s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="20%;23%;17%;20%" dur="15s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.5;0.8;0.35;0.5" dur="4.5s" repeatCount="indefinite"/>
    </circle>
    <circle cx="37%" cy="86%" r="1.8" fill="#7b2fbe" opacity="0.35">
        <animate attributeName="cy" from="96%" to="-5%" dur="30s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="37%;40%;34%;37%" dur="30s" repeatCount="indefinite"/>
    </circle>
    <circle cx="53%" cy="98%" r="1" fill="#0fbcb6" opacity="0.55">
        <animate attributeName="cy" from="108%" to="-5%" dur="20s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="53%;55%;51%;53%" dur="20s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.55;0.8;0.4;0.55" dur="6s" repeatCount="indefinite"/>
    </circle>
    <circle cx="67%" cy="92%" r="2.5" fill="#00f0ff" opacity="0.25">
        <animate attributeName="cy" from="102%" to="-5%" dur="22s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="67%;70%;64%;67%" dur="22s" repeatCount="indefinite"/>
    </circle>
    <circle cx="82%" cy="95%" r="1.2" fill="#e84393" opacity="0.4">
        <animate attributeName="cy" from="105%" to="-5%" dur="19s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="82%;84%;80%;82%" dur="19s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.4;0.7;0.3;0.4" dur="7s" repeatCount="indefinite"/>
    </circle>
    <circle cx="95%" cy="88%" r="1.5" fill="#7b2fbe" opacity="0.35">
        <animate attributeName="cy" from="98%" to="-5%" dur="26s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="95%;97%;93%;95%" dur="26s" repeatCount="indefinite"/>
    </circle>
    <circle cx="45%" cy="84%" r="3" fill="#00cec9" opacity="0.2">
        <animate attributeName="cy" from="94%" to="-5%" dur="30s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="45%;48%;42%;45%" dur="30s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.2;0.45;0.15;0.2" dur="9s" repeatCount="indefinite"/>
    </circle>
    <circle cx="8%" cy="93%" r="1" fill="#ff00aa" opacity="0.5">
        <animate attributeName="cy" from="103%" to="-5%" dur="18s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="8%;11%;6%;8%" dur="18s" repeatCount="indefinite"/>
    </circle>
    <circle cx="73%" cy="100%" r="1.8" fill="#0fbcb6" opacity="0.4">
        <animate attributeName="cy" from="110%" to="-5%" dur="24s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="73%;76%;70%;73%" dur="24s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.4;0.6;0.25;0.4" dur="5.5s" repeatCount="indefinite"/>
    </circle>
    <circle cx="58%" cy="87%" r="1.5" fill="#00f0ff" opacity="0.45">
        <animate attributeName="cy" from="97%" to="-5%" dur="21s" repeatCount="indefinite"/>
        <animate attributeName="cx" values="58%;60%;56%;58%" dur="21s" repeatCount="indefinite"/>
    </circle>
</svg>

<!-- SCANLINE OVERLAY -->
<div class="scanline-overlay"></div>

<!-- APP -->
<div class="app">

    <!-- HEADER -->
    <div class="header">
        <div class="header-title">RELAY</div>
        <div class="header-center">
            <button class="workflow-btn">
                <span class="step-num">1</span> Review Task
            </button>
            <button class="workflow-btn">
                <span class="step-num">2</span> Explain
            </button>
            <button class="workflow-btn">
                <span class="step-num">3</span> Implement
            </button>
        </div>
        <div class="header-controls">
            <div class="health-indicator">
                <div class="health-dot"></div>
                <span class="health-text">Connected</span>
            </div>
            <div class="separator"></div>
            <select class="project-select">
                <option value="relay">relay</option>
                <option>command-conquer</option>
                <option>web-scraper</option>
            </select>
            <div class="separator"></div>
            <button class="icon-btn" title="File Browser">&#128193;</button>
            <button class="icon-btn" title="Git Operations">&#9095;</button>
            <button class="icon-btn" title="Display Settings">&#9707;</button>
            <button class="icon-btn" title="Voice Settings">&#9881;</button>
        </div>
    </div>

    <!-- ACK BANNER -->
    <div class="ack-banner">
        <div class="ack-dot"></div>
        <span class="ack-text">Processing: Implementing JWT token refresh with rotation strategy...</span>
    </div>

    <!-- MAIN 3-PANEL LAYOUT -->
    <div class="main">

        <!-- HISTORY SIDEBAR -->
        <div class="history-sidebar hud-corners hud-corners-bottom">
            <div class="corner-bl"></div>
            <div class="corner-br"></div>
            <div class="pane-header">
                <div class="pane-title">HISTORY</div>
                <div class="pane-controls">
                    <button class="icon-btn" style="width:24px;height:24px;font-size:11px;" title="Collapse">&lsaquo;</button>
                </div>
            </div>
            <div class="history-list">
                <div class="history-item active accent-cyan">
                    <span class="history-title">JWT auth token refresh</span>
                    <span class="history-time">2 min ago</span>
                </div>
                <div class="history-item accent-teal">
                    <span class="history-title">WebSocket connection handler</span>
                    <span class="history-time">18 min ago</span>
                </div>
                <div class="history-item accent-purple">
                    <span class="history-title">Database migration v3.2</span>
                    <span class="history-time">45 min ago</span>
                </div>
                <div class="history-item accent-pink">
                    <span class="history-title">Rate limiter middleware</span>
                    <span class="history-time">1 hr ago</span>
                </div>
                <div class="history-item accent-green">
                    <span class="history-title">Redis cache invalidation</span>
                    <span class="history-time">1.5 hr ago</span>
                </div>
                <div class="history-item accent-teal">
                    <span class="history-title">GraphQL resolver types</span>
                    <span class="history-time">2 hr ago</span>
                </div>
                <div class="history-item accent-purple">
                    <span class="history-title">Docker compose setup</span>
                    <span class="history-time">3 hr ago</span>
                </div>
                <div class="history-item accent-cyan">
                    <span class="history-title">Unit test coverage fix</span>
                    <span class="history-time">4 hr ago</span>
                </div>
            </div>
            <div class="history-count">8 conversations</div>
        </div>

        <!-- AXION PANEL -->
        <div class="pane response-pane hud-corners hud-corners-bottom gradient-border">
            <div class="corner-bl"></div>
            <div class="corner-br"></div>
            <div class="pane-header">
                <div class="pane-title">
                    <div class="axion-title-area">
                        <span>AXION</span>
                    </div>
                </div>
                <div class="pane-controls">
                    <button class="icon-btn" style="width:24px;height:24px;font-size:12px;" title="Auto-read">&#128263;</button>
                    <button class="icon-btn" style="width:24px;height:24px;font-size:12px;" title="Read aloud">&#128266;</button>
                    <button class="icon-btn" style="width:24px;height:24px;font-size:12px;" title="Screenshots">&#128444;</button>
                    <button class="icon-btn" style="width:24px;height:24px;font-size:12px;" title="Clear">&#128465;</button>
                </div>
            </div>
            <div class="pane-content">
                <!-- Live Activity Box -->
                <div class="live-activity-box">
                    <div class="live-activity-header">
                        <span class="live-indicator">LIVE</span>
                        <span class="live-status">Processing request...</span>
                    </div>
                    <div class="live-activity-content">
                        <span class="tool-call">&#9656; Read</span> auth/token_manager.py &mdash; analyzing refresh token rotation
                    </div>
                    <div class="voice-visualizer">
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                    </div>
                </div>

                <!-- Message 1: User -->
                <div class="message user">
                    <div class="message-header">
                        <span class="message-sender user-name">BRETT</span>
                        <span class="message-time">14:32</span>
                    </div>
                    <div class="message-body">
                        <p>Implement a JWT token refresh mechanism with rotation. Each time a refresh token is used, it should be invalidated and a new one issued. Include the database schema and the middleware.</p>
                    </div>
                </div>

                <!-- Message 2: Assistant -->
                <div class="message assistant">
                    <div class="message-header">
                        <span class="message-sender ai-name">AXION</span>
                        <span class="message-time">14:33</span>
                    </div>
                    <div class="message-body">
                        <p>I'll implement JWT token refresh with rotation. Here's the token manager with automatic invalidation:</p>
                        <div class="code-block">
                            <span class="code-lang">python</span>
<span class="code-keyword">class</span> <span class="code-type">TokenManager</span>:
    <span class="code-keyword">def</span> <span class="code-function">rotate_refresh_token</span>(<span class="code-variable">self</span>, <span class="code-variable">old_token</span>: <span class="code-type">str</span>) -> <span class="code-type">TokenPair</span>:
        <span class="code-comment"># Validate and invalidate the old refresh token</span>
        <span class="code-variable">payload</span> = <span class="code-variable">self</span>.<span class="code-function">verify_token</span>(<span class="code-variable">old_token</span>, <span class="code-string">"refresh"</span>)
        <span class="code-variable">token_record</span> = <span class="code-variable">self</span>.<span class="code-variable">db</span>.<span class="code-function">get_refresh_token</span>(<span class="code-variable">payload</span>[<span class="code-string">"jti"</span>])

        <span class="code-keyword">if</span> <span class="code-variable">token_record</span>.<span class="code-variable">is_revoked</span>:
            <span class="code-comment"># Token reuse detected - revoke entire family</span>
            <span class="code-variable">self</span>.<span class="code-function">revoke_token_family</span>(<span class="code-variable">token_record</span>.<span class="code-variable">family_id</span>)
            <span class="code-keyword">raise</span> <span class="code-type">SecurityException</span>(<span class="code-string">"Token reuse detected"</span>)

        <span class="code-comment"># Issue new token pair with same family_id</span>
        <span class="code-variable">self</span>.<span class="code-variable">db</span>.<span class="code-function">revoke_token</span>(<span class="code-variable">token_record</span>.<span class="code-variable">id</span>)
        <span class="code-keyword">return</span> <span class="code-variable">self</span>.<span class="code-function">create_token_pair</span>(
            <span class="code-variable">user_id</span>=<span class="code-variable">payload</span>[<span class="code-string">"sub"</span>],
            <span class="code-variable">family_id</span>=<span class="code-variable">token_record</span>.<span class="code-variable">family_id</span>
        )
                        </div>
                        <p>The key security feature is the token family tracking. If a revoked token is reused (indicating theft), the entire family is invalidated, forcing the user to re-authenticate.</p>
                    </div>
                </div>

                <!-- Message 3: User follow-up -->
                <div class="message user">
                    <div class="message-header">
                        <span class="message-sender user-name">BRETT</span>
                        <span class="message-time">14:35</span>
                    </div>
                    <div class="message-body">
                        <p>Now add the database migration for the refresh_tokens table. Use SQLAlchemy with proper indexes on family_id and jti columns.</p>
                    </div>
                </div>

                <!-- Message 4: Assistant -->
                <div class="message assistant">
                    <div class="message-header">
                        <span class="message-sender ai-name">AXION</span>
                        <span class="message-time">14:36</span>
                    </div>
                    <div class="message-body">
                        <p>Here's the Alembic migration with optimized indexes:</p>
                        <div class="code-block">
                            <span class="code-lang">python</span>
<span class="code-keyword">def</span> <span class="code-function">upgrade</span>() -> <span class="code-type">None</span>:
    op.<span class="code-function">create_table</span>(<span class="code-string">'refresh_tokens'</span>,
        sa.<span class="code-function">Column</span>(<span class="code-string">'id'</span>, sa.<span class="code-type">UUID</span>, <span class="code-variable">primary_key</span>=<span class="code-keyword">True</span>),
        sa.<span class="code-function">Column</span>(<span class="code-string">'jti'</span>, sa.<span class="code-type">String</span>(<span class="code-number">64</span>), <span class="code-variable">unique</span>=<span class="code-keyword">True</span>),
        sa.<span class="code-function">Column</span>(<span class="code-string">'family_id'</span>, sa.<span class="code-type">UUID</span>, <span class="code-variable">nullable</span>=<span class="code-keyword">False</span>),
        sa.<span class="code-function">Column</span>(<span class="code-string">'user_id'</span>, sa.<span class="code-type">UUID</span>, sa.<span class="code-function">ForeignKey</span>(<span class="code-string">'users.id'</span>)),
        sa.<span class="code-function">Column</span>(<span class="code-string">'is_revoked'</span>, sa.<span class="code-type">Boolean</span>, <span class="code-variable">default</span>=<span class="code-keyword">False</span>),
        sa.<span class="code-function">Column</span>(<span class="code-string">'expires_at'</span>, sa.<span class="code-type">DateTime</span>(<span class="code-variable">timezone</span>=<span class="code-keyword">True</span>)),
    )
    op.<span class="code-function">create_index</span>(<span class="code-string">'ix_refresh_family'</span>, <span class="code-string">'refresh_tokens'</span>,
                   [<span class="code-string">'family_id'</span>, <span class="code-string">'is_revoked'</span>])
                        </div>
                        <p>The composite index on <code style="background:rgba(0,240,255,0.08);padding:1px 6px;border-radius:3px;font-size:12px;">(family_id, is_revoked)</code> optimizes the family revocation query. I also added a TTL index on <code style="background:rgba(0,240,255,0.08);padding:1px 6px;border-radius:3px;font-size:12px;">expires_at</code> for automatic cleanup of expired tokens.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- BRETT INPUT PANEL -->
        <div class="pane input-pane hud-corners hud-corners-bottom">
            <div class="corner-bl"></div>
            <div class="corner-br"></div>
            <div class="pane-header">
                <div class="pane-title"><span>BRETT</span></div>
                <div class="pane-controls">
                    <button class="icon-btn" style="width:26px;height:26px;font-size:12px;" title="Copy text">&#128203;</button>
                    <button class="icon-btn" style="width:26px;height:26px;font-size:12px;" title="Clear text">&#128465;</button>
                    <button class="icon-btn" style="width:26px;height:26px;font-size:12px;" title="Voice input">&#127908;</button>
                    <button class="icon-btn" style="width:26px;height:26px;font-size:12px;" title="Read aloud">&#128266;</button>
                    <button class="icon-btn" style="width:26px;height:26px;font-size:12px;" title="Format text">&#10024;</button>
                    <button class="icon-btn" style="width:26px;height:26px;font-size:12px;" title="Design Mockup">&#127912;</button>
                    <button class="send-btn" title="Send message">&#9654;</button>
                </div>
            </div>
            <div class="pane-content" style="padding:0;">
                <div class="input-wrapper">
                    <div class="line-numbers">
                         1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br>10<br>11<br>12<br>13<br>14<br>15
                    </div>
                    <textarea class="input-area" spellcheck="false" readonly>Now add the WebSocket handler that
listens for token refresh events.

Requirements:
- Use asyncio with proper cleanup
- Broadcast to all sessions in the
  same token family when revoked
- Include heartbeat ping/pong
- Add connection pooling with max
  connections per user (limit: 5)
- Graceful shutdown on SIGTERM
- Log all auth events to the
  security audit table
- Rate limit: max 10 refreshes
  per minute per user</textarea>
                </div>
            </div>
            <div class="shortcut-hint">
                <kbd>Ctrl</kbd>+<kbd>Enter</kbd> to send &nbsp;&middot;&nbsp; <kbd>Shift</kbd>+<kbd>Enter</kbd> for newline
            </div>
        </div>
    </div>

    <!-- SHORTCUTS BAR -->
    <div class="shortcuts-bar">
        <span><kbd>Ctrl</kbd>+<kbd>Enter</kbd> Send</span>
        <span><kbd>Esc</kbd> Close</span>
        <span><kbd>Ctrl</kbd>+<kbd>/</kbd> Sidebar</span>
    </div>
</div>

<!-- MESSAGE QUEUE PANEL -->
<div class="queue-panel hud-corners hud-corners-bottom">
    <div class="corner-bl"></div>
    <div class="corner-br"></div>
    <div class="queue-header">
        <span class="queue-title">Message Queue (2)</span>
        <button class="queue-clear">Clear All</button>
    </div>
    <div class="queue-list">
        <div class="queue-item">
            <div class="queue-item-dot pending"></div>
            <span class="queue-item-text">Add rate limiter to refresh endpoint</span>
            <span class="queue-item-time">queued</span>
        </div>
        <div class="queue-item">
            <div class="queue-item-dot waiting"></div>
            <span class="queue-item-text">Write integration tests for token rotation</span>
            <span class="queue-item-time">waiting</span>
        </div>
    </div>
</div>

</body>
</html>
