<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>RELAY</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Theme flash prevention - must run before CSS -->
    <script>
    (function(){var t=localStorage.getItem('relayTheme')||'dark';if(t==='system')t=window.matchMedia('(prefers-color-scheme:light)').matches?'light':'dark';if(t==='light')document.documentElement.setAttribute('data-theme','light');})();
    </script>
    <!-- Highlight.js for syntax highlighting -->
    <link id="hljs-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Mermaid.js for diagram rendering -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({ startOnLoad: false, theme: 'dark', securityLevel: 'loose', themeVariables: { primaryColor: '#0fbcb6', primaryTextColor: '#e8ecf4', primaryBorderColor: '#00f0ff', lineColor: '#00f0ff', secondaryColor: '#0a0018', tertiaryColor: '#000000' }});</script>
    <style>{{CSS_PLACEHOLDER}}</style>
</head>
<body>
    <!-- Scanline Overlay -->
    <div class="scanline-overlay"></div>

    <div class="app">
        <div class="header">
            <h1>RELAY</h1>
            <div class="header-center">
                <button class="workflow-btn" id="btnReviewTask" onclick="runWorkflowCommand('reviewtask')" title="Takes your input text + images, creates TASK.md, then runs /reviewtask to structure it">
                    <span class="step-num">1</span> Review Task
                </button>
                <button class="workflow-btn" id="btnExplain" onclick="runWorkflowCommand('explain')" title="Analyze task and create plan">
                    <span class="step-num">2</span> Explain
                </button>
                <button class="workflow-btn" id="btnImplement" onclick="runWorkflowCommand('implement')" title="Execute the implementation">
                    <span class="step-num">3</span> Implement
                </button>
            </div>
            <div class="header-controls">
                <button class="mobile-panel-switch" id="mobilePanelSwitch" onclick="toggleMobilePanel()" title="Switch Panel">
                    <span id="mobilePanelLabel">AXION</span>
                </button>
                <div class="health-indicator" id="healthIndicator" onclick="showHealthDetails()" title="Click for details">
                    <div class="health-dot checking" id="healthDot"></div>
                </div>
                <button class="icon-btn danger" id="resetBtn" onclick="openResetModal()" style="display:none;" title="Reset System">‚Üª</button>
                <!-- Desktop: individual buttons -->
                <div class="desktop-controls">
                    <div class="separator"></div>
                    <!-- Model Selector -->
                    <select id="modelSelect" class="model-select" onchange="switchModel(this.value)" title="Select AI Model">
                        <optgroup label="Claude">
                            <option value="opus" selected>üü£ Claude Opus</option>
                            <option value="sonnet">üîµ Claude Sonnet</option>
                            <option value="haiku">‚ö° Claude Haiku (Fast)</option>
                        </optgroup>
                        <optgroup label="NVIDIA NIM - Verified Working">
                            <option value="meta/llama-3.1-8b-instruct">‚ö° Llama 3.1 8B (Fast)</option>
                            <option value="meta/llama-3.1-70b-instruct">üü¢ Llama 3.1 70B</option>
                            <option value="meta/llama-3.3-70b-instruct">üü¢ Llama 3.3 70B</option>
                            <option value="mistralai/mistral-large-2-instruct">üü¢ Mistral Large 2</option>
                            <option value="mistralai/mixtral-8x22b-instruct-v0.1">üü¢ Mixtral 8x22B</option>
                        </optgroup>
                        <optgroup label="NVIDIA NIM - Reasoning">
                            <option value="deepseek-ai/deepseek-r1-distill-qwen-32b">üß† DeepSeek R1 32B</option>
                            <option value="deepseek-ai/deepseek-r1-distill-qwen-14b">üß† DeepSeek R1 14B</option>
                            <option value="qwen/qwq-32b">üß† QwQ 32B</option>
                        </optgroup>
                        <optgroup label="NVIDIA NIM - Code">
                            <option value="ibm/granite-34b-code-instruct">üíª Granite 34B Code</option>
                            <option value="qwen/qwen2.5-coder-32b-instruct">üíª Qwen 2.5 Coder 32B</option>
                            <option value="deepseek-ai/deepseek-coder-6.7b-instruct">üíª DeepSeek Coder 6.7B</option>
                        </optgroup>
                        <optgroup label="OpenAI">
                            <option value="openai/gpt-4o">üîµ GPT-4o</option>
                            <option value="openai/gpt-4o-mini">üîµ GPT-4o Mini</option>
                        </optgroup>
                    </select>
                    <div class="separator"></div>
                    <button class="icon-btn new-project-btn" onclick="openNewProjectModal()" title="New Project">+</button>
                    <select id="projectSelect" class="project-select">
                        <option value="">No Project</option>
                    </select>
                    <button class="icon-btn danger delete-project-btn" onclick="openDeleteProjectModal()" title="Delete Project" style="font-size:12px;">üóë</button>
                    <div class="separator"></div>
                    <button class="icon-btn" onclick="openFileBrowser()" title="File Browser">üìÅ</button>
                    <button class="icon-btn" onclick="openJobHistoryModal()" title="Job History">üìú</button>
                    <button class="icon-btn" onclick="openGitModal()" title="Git Operations">‚éá</button>
                    <button class="icon-btn" onclick="openDisplaySettings()" title="Display Settings">‚ó´</button>
                    <button class="icon-btn" onclick="openVoiceSettings()" title="Voice Settings">‚öô</button>
                    <div class="separator"></div>
                    <button class="icon-btn danger" onclick="confirmLogout()" title="Clear Session (Logout)">‚èª</button>
                </div>
                <!-- Mobile: hamburger menu with all controls inside -->
                <div class="mobile-controls">
                    <div class="menu-container">
                        <button class="icon-btn menu-btn" id="menuBtn" onclick="toggleActionsMenu()" title="Menu">‚ò∞</button>
                        <div class="actions-menu-overlay" id="actionsMenuOverlay" onclick="toggleActionsMenu()"></div>
                        <div class="actions-menu" id="actionsMenu" style="display:none;">
                            <div class="actions-menu-section">
                                <div class="actions-menu-label">Model</div>
                                <select id="modelSelectMobile" class="mobile-menu-select" onchange="switchModel(this.value)" title="Select AI Model">
                                    <optgroup label="Claude">
                                        <option value="opus" selected>üü£ Opus</option>
                                        <option value="sonnet">üîµ Sonnet</option>
                                        <option value="haiku">‚ö° Haiku</option>
                                    </optgroup>
                                    <optgroup label="NVIDIA NIM">
                                        <option value="meta/llama-3.1-8b-instruct">‚ö° Llama 8B</option>
                                        <option value="meta/llama-3.1-70b-instruct">üü¢ Llama 70B</option>
                                        <option value="meta/llama-3.3-70b-instruct">üü¢ Llama 3.3</option>
                                        <option value="mistralai/mistral-large-2-instruct">üü¢ Mistral L2</option>
                                        <option value="deepseek-ai/deepseek-r1-distill-qwen-32b">üß† DeepSeek 32B</option>
                                        <option value="qwen/qwen2.5-coder-32b-instruct">üíª Qwen Coder</option>
                                    </optgroup>
                                    <optgroup label="OpenAI">
                                        <option value="openai/gpt-4o">üîµ GPT-4o</option>
                                        <option value="openai/gpt-4o-mini">üîµ GPT-4o Mini</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="actions-menu-section">
                                <div class="actions-menu-label">Project</div>
                                <select id="projectSelectMobile" class="mobile-menu-select">
                                    <option value="">No Project</option>
                                </select>
                            </div>
                            <div class="actions-menu-divider"></div>
                            <div class="actions-menu-item" onclick="document.getElementById('mobileFileInput').click(); toggleActionsMenu();">
                                <span class="menu-icon">üìé</span> Attach File
                            </div>
                            <div class="actions-menu-item" onclick="openFileBrowser(); toggleActionsMenu();">
                                <span class="menu-icon">üìÅ</span> File Browser
                            </div>
                            <div class="actions-menu-item" onclick="openGitModal(); toggleActionsMenu();">
                                <span class="menu-icon">‚éá</span> Git Operations
                            </div>
                            <div class="actions-menu-item" onclick="openDisplaySettings(); toggleActionsMenu();">
                                <span class="menu-icon">‚ó´</span> Display Settings
                            </div>
                            <div class="actions-menu-item" onclick="openVoiceSettings(); toggleActionsMenu();">
                                <span class="menu-icon">‚öô</span> Voice Settings
                            </div>
                            <div class="actions-menu-divider"></div>
                            <div class="actions-menu-item danger" onclick="confirmLogout(); toggleActionsMenu();">
                                <span class="menu-icon">‚èª</span> Logout
                            </div>
                        </div>
                    </div>
                    <input type="file" id="mobileFileInput" style="display:none;" multiple onchange="handleMobileFileAttach(this)">
                </div>
            </div>
        </div>

        <!-- Job acknowledgment banner -->
        <div id="ackBanner" class="ack-banner" style="display:none;">
            <span id="ackText">Message received - waiting for Claude...</span>
        </div>

        <!-- Message Queue Panel -->
        <div id="queuePanel" class="queue-panel">
            <div class="queue-header">
                <span class="queue-title">Message Queue (<span id="queueCount">0</span>)</span>
                <button class="btn" onclick="clearQueue()" style="padding:4px 8px;font-size:11px;">Clear All</button>
            </div>
            <div class="queue-list" id="queueList"></div>
        </div>

        <!-- Reset System Modal -->
        <div id="resetModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>System Controls</h3>
                    <button class="modal-close" onclick="closeResetModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="reset-option" onclick="resetAction('clear-queue')">
                        <div class="reset-option-title">Clear Message Queue</div>
                        <div class="reset-option-desc">Remove all pending messages from the queue</div>
                    </div>
                    <div class="reset-option" onclick="resetAction('restart-watcher')">
                        <div class="reset-option-title">Restart Watcher</div>
                        <div class="reset-option-desc">Stop and restart the job processor</div>
                    </div>
                    <div class="reset-option" onclick="resetAction('cancel-current')">
                        <div class="reset-option-title">Cancel Current Job</div>
                        <div class="reset-option-desc">Stop the currently processing job</div>
                    </div>
                    <div class="reset-option danger" onclick="resetAction('full-reset')">
                        <div class="reset-option-title">Full System Reset</div>
                        <div class="reset-option-desc">Clear queue, restart watcher, reset everything</div>
                    </div>
                    <div id="resetStatus" class="reset-status"></div>
                </div>
            </div>
        </div>

        <!-- New Project Modal -->
        <div id="newProjectModal" class="modal-overlay" style="display:none;">
            <div class="modal-content new-project-modal">
                <div class="modal-header">
                    <h3>Create New Project</h3>
                    <button class="modal-close" onclick="closeNewProjectModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="new-project-form">
                        <label for="newProjectName">Project Name</label>
                        <input type="text" id="newProjectName" placeholder="my-new-project" autocomplete="off" onkeydown="if(event.key==='Enter')createNewProject()">
                        <p class="new-project-hint">Use lowercase letters, numbers, and hyphens only</p>

                        <div class="new-project-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="newProjectInitGit" checked>
                                <span>Initialize Git repository</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="newProjectCopyTemplate" checked>
                                <span>Copy .claude template (commands & skills)</span>
                            </label>
                        </div>

                        <div id="newProjectStatus" class="new-project-status"></div>

                        <div class="new-project-actions">
                            <button class="btn" onclick="closeNewProjectModal()">Cancel</button>
                            <button class="btn primary" onclick="createNewProject()">Create Project</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Project Modal -->
        <div id="deleteProjectModal" class="modal-overlay" style="display:none;">
            <div class="modal-content delete-project-modal">
                <div class="modal-header" style="background:rgba(248,81,73,0.1);border-bottom-color:rgba(248,81,73,0.3);">
                    <h3 style="color:var(--error);">Delete Project</h3>
                    <button class="modal-close" onclick="closeDeleteProjectModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="delete-project-warning" style="background:rgba(248,81,73,0.1);border:1px solid rgba(248,81,73,0.3);border-radius:8px;padding:16px;margin-bottom:16px;">
                        <p style="color:var(--error);font-weight:600;margin:0 0 8px 0;">WARNING: This action cannot be undone!</p>
                        <p style="color:var(--text-secondary);margin:0;font-size:13px;">This will permanently delete the project folder and all its contents from your local system.</p>
                    </div>

                    <div class="delete-project-form">
                        <p style="margin-bottom:12px;">To confirm deletion of <strong id="deleteProjectName" style="color:var(--cyan);">project-name</strong>, type the project name below:</p>

                        <input type="text" id="deleteProjectConfirmInput" placeholder="Type project name to confirm" autocomplete="off" style="width:100%;padding:12px;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:14px;margin-bottom:16px;">

                        <div class="delete-project-options" style="margin-bottom:16px;">
                            <label class="checkbox-label" style="display:flex;align-items:flex-start;gap:10px;cursor:pointer;">
                                <input type="checkbox" id="deleteFromGitHub" style="margin-top:3px;">
                                <span style="font-size:13px;">
                                    <strong style="color:var(--error);">Also delete from GitHub</strong><br>
                                    <span style="color:var(--text-secondary);">Type "delete" below to confirm GitHub deletion</span>
                                </span>
                            </label>
                            <input type="text" id="deleteGitHubConfirmInput" placeholder="Type 'delete' to confirm GitHub deletion" autocomplete="off" style="width:100%;padding:10px;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px;margin-top:8px;display:none;">
                        </div>

                        <div id="deleteProjectStatus" style="margin-bottom:12px;"></div>

                        <div class="delete-project-actions" style="display:flex;gap:12px;justify-content:flex-end;">
                            <button class="btn" onclick="closeDeleteProjectModal()">Cancel</button>
                            <button class="btn danger" id="confirmDeleteBtn" onclick="confirmDeleteProject()" disabled style="background:var(--error);opacity:0.5;cursor:not-allowed;">Delete Project</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <main class="main">
            <!-- History Sidebar -->
            <div class="history-sidebar hud-corners hud-corners-bottom" id="historySidebar">
                <div class="corner-bl"></div><div class="corner-br"></div>
                <div class="pane-header">
                    <div class="pane-title" id="historyPaneTitle">History</div>
                    <div class="pane-controls">
                        <button class="icon-btn" id="historyModeToggle" onclick="toggleHistoryMode()" title="Switch to Image History">üñº</button>
                        <button class="btn" onclick="toggleHistorySidebar()" title="Collapse">&lsaquo;</button>
                    </div>
                </div>
                <div class="history-list" id="historyList">
                    <div style="color:var(--text-secondary);text-align:center;padding:20px;">Select a project to see history</div>
                </div>
                <div class="history-count" id="historyCount"></div>
                <button class="btn delete-selected-btn" id="deleteSelectedBtn" onclick="deleteSelectedHistory()">Delete Selected (<span id="selectedCount">0</span>)</button>
                <button class="btn" onclick="clearHistory()" style="width:100%;margin-top:8px;background:var(--error);color:white;" title="Clear all history">Clear All History</button>
            </div>

            <!-- AXION Panel - Responses -->
            <div class="pane response-pane hud-corners hud-corners-bottom gradient-border" id="axionPane" ondblclick="toggleFullscreen()">
                <div class="corner-bl"></div><div class="corner-br"></div>
                <div class="pane-header">
                    <div class="pane-title">
                        <button class="icon-btn" id="sidebarToggle" onclick="toggleHistorySidebar()" style="display:none;" title="Toggle History">üìö</button>
                        <span>AXION</span>
                        <span class="fullscreen-hint">(double-click to exit)</span>
                    </div>
                    <!-- Mobile tabs for switching between Response and History -->
                    <div class="axion-mobile-tabs" id="axionMobileTabs">
                        <button class="axion-tab active" data-tab="response" onclick="switchAxionMobileTab('response')">Response</button>
                        <button class="axion-tab" data-tab="history" onclick="switchAxionMobileTab('history')">History</button>
                    </div>
                    <div class="pane-controls">
                        <button class="icon-btn danger" id="pauseBtn" onclick="togglePause()" style="display:none;" title="Pause to add more info">‚è∏</button>
                        <button class="icon-btn" id="autoReadBtn" onclick="toggleAutoRead()" title="Auto-read responses">üîá</button>
                        <button class="icon-btn" id="readResponseBtn" onclick="readResponse()" title="Read aloud">üîä</button>
                        <button class="icon-btn" onclick="showScreenshotGallery()" title="Screenshots">üñº</button>
                        <button class="icon-btn" onclick="clearResponse()" title="Clear">üóë</button>
                        <button class="icon-btn" id="quickMsgBtn" onclick="toggleQuickMessage()" title="Send message to Claude" style="display:none;">üí¨</button>
                    </div>
                </div>
                <!-- Quick Message Bar (slides down when active) -->
                <div class="quick-msg-bar" id="quickMsgBar" style="display:none;">
                    <div class="quick-msg-inner">
                        <textarea class="quick-msg-input" id="quickMsgInput" placeholder="Send a message to Claude..." rows="1"></textarea>
                        <button class="quick-msg-send" id="quickMsgSendBtn" onclick="sendQuickMessage()" title="Send">‚ñ∂</button>
                        <button class="quick-msg-close" onclick="toggleQuickMessage()" title="Close">&times;</button>
                    </div>
                </div>
                <div class="pane-content" id="axionPaneContent">
                    <!-- Live Activity Box - Shows Claude's live responses at top -->
                    <div class="live-activity-box" id="liveActivityBox">
                        <div class="live-activity-header">
                            <span class="live-indicator">‚óè LIVE</span>
                            <span class="live-status" id="liveStatus">Waiting...</span>
                        </div>
                        <div class="live-activity-content" id="liveActivityContent"></div>
                        <div class="live-voice-visualizer" id="liveVoiceVisualizer">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    </div>
                    <!-- History area - completed content (chronological, oldest first) -->
                    <div class="response-area" id="responseArea"></div>
                    <!-- Mobile History List (shown when History tab is active on mobile) -->
                    <div class="mobile-history-container" id="mobileHistoryContainer">
                        <div class="mobile-history-list" id="mobileHistoryList">
                            <div style="color:var(--text-secondary);text-align:center;padding:20px;">Select a project to see history</div>
                        </div>
                        <div class="mobile-history-actions">
                            <button class="btn" onclick="loadHistoryItemMobile()" id="mobileLoadHistoryBtn" disabled>Load Selected</button>
                            <button class="btn danger" onclick="deleteSelectedHistoryMobile()" id="mobileDeleteHistoryBtn" disabled>Delete Selected</button>
                        </div>
                    </div>
                </div>
                <!-- Scroll to Bottom button - positioned relative to AXION pane -->
                <button class="scroll-to-bottom-btn" id="scrollToBottomBtn" onclick="scrollAxionToBottom()" title="Scroll to bottom">&#8595; Bottom</button>
            </div>

            <!-- BRETT Panel - Input -->
            <div class="pane input-pane hud-corners hud-corners-bottom" id="brettPane" ondblclick="toggleBrettFullscreen(event)">
                <div class="corner-bl"></div><div class="corner-br"></div>
                <div class="pane-header">
                    <div class="pane-title">
                        <span>BRETT</span>
                        <span class="fullscreen-hint">(double-click to exit)</span>
                        <div class="voice-dots" id="voiceDots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
                    </div>
                    <div class="pane-controls">
                        <button class="icon-btn" id="copyInputBtn" onclick="copyInputText()" title="Copy text">üìã</button>
                        <button class="icon-btn" id="attachFileBtn" onclick="document.getElementById('desktopFileInput').click()" title="Attach file">üìé</button>
                        <input type="file" id="desktopFileInput" style="display:none;" multiple onchange="handleMobileFileAttach(this)">
                        <button class="icon-btn" onclick="clearInput()" title="Clear text">üóë</button>
                        <button class="icon-btn" id="voiceBtn" onclick="toggleVoice()" title="Voice input">üé§</button>
                        <button class="icon-btn" id="readInputBtn" onclick="readInput()" title="Read aloud">üîä</button>
                        <button class="icon-btn" onclick="startMockup()" title="Design Mockup">üé®</button>
                        <button class="icon-btn" onclick="openYouTubeModal()" title="Add YouTube Video">üì∫</button>
                        <button class="icon-btn" id="formatBtn" onclick="formatInput()" title="Format text with Claude">‚ú®</button>
                        <button class="icon-btn skills-btn" id="skillsBtn" onclick="toggleSkillsPanel()" title="Skills">‚ö°</button>
                        <button class="icon-btn primary" onclick="sendMessage()" title="Send message (Ctrl+Enter)">‚ñ∂</button>
                    </div>
                </div>
                <!-- Active Skills Indicator -->
                <div class="active-skills-bar" id="activeSkillsBar" style="display:none;">
                    <span class="active-skills-label">Running:</span>
                    <div class="active-skills-list" id="activeSkillsList"></div>
                </div>
                <div class="pane-content">
                    <div class="input-wrapper">
                        <div class="line-numbers" id="lineNumbers">1</div>
                        <textarea class="input-area" id="inputArea" placeholder="Type your message... (Ctrl+Enter to send, Shift+Enter for newline)"></textarea>
                    </div>
                </div>
                <div id="imageContainer" class="image-preview-container" style="display:none;"></div>
            </div>
        </main>

        <!-- Questions Modal -->
        <div id="questionsModal" class="modal-overlay">
            <div class="modal-content" style="max-width:650px;">
                <div class="modal-header">
                    <h3>Claude needs your input</h3>
                    <button class="modal-close" onclick="skipQuestions()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="questionsPreview" style="background:var(--bg);padding:12px;border-radius:6px;margin-bottom:16px;max-height:200px;overflow-y:auto;font-size:13px;color:var(--text-secondary);"></div>
                    <div id="questionsForm"></div>

                    <!-- Additional Context Section -->
                    <div class="questions-context-section" style="margin-top:16px; border-top:1px solid var(--border); padding-top:16px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                            <label style="color:var(--text-secondary); font-size:13px;">Additional context or details (optional):</label>
                            <button class="icon-btn" id="questionsVoiceBtn" onclick="toggleQuestionsVoice()" title="Voice input" style="font-size:16px;">üé§</button>
                        </div>
                        <textarea id="questionsContextInput" placeholder="Add any extra information, clarifications, or context you want Claude to know..." style="width:100%; min-height:80px; padding:10px; background:var(--bg-input); border:1px solid var(--border); border-radius:6px; color:var(--text); font-size:14px; resize:vertical;"></textarea>
                        <div id="questionsVoiceIndicator" style="display:none; color:var(--accent); font-size:12px; margin-top:4px;">üî¥ Listening... speak now</div>
                    </div>

                    <div style="display:flex;gap:8px;margin-top:16px;">
                        <button class="btn success" onclick="submitAnswers()">Send Answers</button>
                        <button class="btn" onclick="skipQuestions()">Skip</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Display Settings Modal -->
        <div id="displayModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); z-index:2000; padding:40px;">
            <div style="background:var(--bg-pane); border:1px solid var(--border); border-radius:8px; max-width:500px; margin:0 auto;">
                <div style="padding:16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0;">Display Settings</h3>
                    <button onclick="closeDisplaySettings()" style="background:none; border:none; color:var(--text); font-size:20px; cursor:pointer;">&times;</button>
                </div>
                <div style="padding:16px;">
                    <!-- Theme Toggle -->
                    <div style="margin-bottom:20px; padding-bottom:16px; border-bottom:1px solid var(--border);">
                        <label style="display:block; margin-bottom:10px; color:var(--text-secondary);">Theme:</label>
                        <div style="display:flex; gap:8px;">
                            <button class="btn theme-btn" id="themeDark" onclick="setTheme('dark')" style="flex:1;">üåô Dark</button>
                            <button class="btn theme-btn" id="themeLight" onclick="setTheme('light')" style="flex:1;">‚òÄÔ∏è Light</button>
                            <button class="btn theme-btn" id="themeSystem" onclick="setTheme('system')" style="flex:1;">üíª Auto</button>
                        </div>
                    </div>

                    <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">AXION Font Size: <span id="axionSizeLabel">14px</span></label>
                    <input type="range" id="axionFontSize" min="10" max="24" value="14" style="width:100%; margin-bottom:16px;" oninput="previewAxionFont(this.value)">

                    <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">BRETT Font Size: <span id="brettSizeLabel">14px</span></label>
                    <input type="range" id="brettFontSize" min="10" max="24" value="14" style="width:100%; margin-bottom:16px;" oninput="previewBrettFont(this.value)">

                    <div style="border-top:1px solid var(--border); margin:16px 0; padding-top:16px;">
                        <h4 style="margin:0 0 12px 0; color:var(--accent);">File Browser Settings</h4>

                        <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">Code Editor Font Size: <span id="editorSizeLabel">14px</span></label>
                        <input type="range" id="editorFontSize" min="10" max="24" value="14" style="width:100%; margin-bottom:16px;" oninput="previewEditorFont(this.value)">

                        <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">Explain Panel Font Size: <span id="explainSizeLabel">14px</span></label>
                        <input type="range" id="explainFontSize" min="10" max="24" value="14" style="width:100%; margin-bottom:16px;" oninput="previewExplainFont(this.value)">

                        <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">File Tree Font Size: <span id="fileTreeSizeLabel">13px</span></label>
                        <input type="range" id="fileTreeFontSize" min="10" max="20" value="13" style="width:100%; margin-bottom:16px;" oninput="previewFileTreeFont(this.value)">
                    </div>

                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn primary" onclick="saveDisplaySettings()">Save</button>
                        <button class="btn" onclick="resetDisplaySettings()">Reset to Default</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- YouTube URL Modal -->
        <div id="youtubeModal" class="modal-overlay">
            <div class="modal-content" style="max-width:550px;">
                <div class="modal-header">
                    <h3>üì∫ Download YouTube Video</h3>
                    <button class="modal-close" onclick="closeYouTubeModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p style="color:var(--text-secondary);margin-bottom:16px;">Enter a YouTube URL to download and analyze. The video will be transcribed and frames will be extracted for Claude to analyze.</p>

                    <label style="color:var(--text-secondary);font-size:13px;display:block;margin-bottom:4px;">YouTube URL:</label>
                    <input type="text" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=..." style="width:100%;padding:12px;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:14px;margin-bottom:16px;">

                    <div style="display:flex;gap:16px;margin-bottom:16px;">
                        <label style="display:flex;align-items:center;gap:6px;color:var(--text-secondary);cursor:pointer;">
                            <input type="checkbox" id="ytAnalyze" checked style="accent-color:var(--accent);">
                            Extract frames
                        </label>
                        <label style="display:flex;align-items:center;gap:6px;color:var(--text-secondary);cursor:pointer;">
                            <input type="checkbox" id="ytTranscribe" checked style="accent-color:var(--accent);">
                            Transcribe audio
                        </label>
                    </div>

                    <div style="display:flex;gap:12px;margin-bottom:16px;">
                        <div style="flex:1;">
                            <label style="color:var(--text-secondary);font-size:12px;display:block;margin-bottom:4px;">Frames to extract:</label>
                            <select id="ytFrames" style="width:100%;padding:8px;background:var(--bg-input);border:1px solid var(--border);border-radius:4px;color:var(--text);">
                                <option value="3">3 frames</option>
                                <option value="5" selected>5 frames</option>
                                <option value="10">10 frames</option>
                                <option value="15">15 frames</option>
                                <option value="20">20 frames</option>
                            </select>
                        </div>
                        <div style="flex:1;">
                            <label style="color:var(--text-secondary);font-size:12px;display:block;margin-bottom:4px;">Whisper model:</label>
                            <select id="ytWhisperModel" style="width:100%;padding:8px;background:var(--bg-input);border:1px solid var(--border);border-radius:4px;color:var(--text);">
                                <option value="tiny">Tiny (fast)</option>
                                <option value="base" selected>Base (balanced)</option>
                                <option value="small">Small (accurate)</option>
                                <option value="medium">Medium (more accurate)</option>
                                <option value="large">Large (best, slow)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Context / Instructions for Claude -->
                    <label style="color:var(--text-secondary);font-size:13px;display:block;margin-bottom:4px;">Context &amp; Instructions for Claude:</label>
                    <div style="position:relative;margin-bottom:16px;">
                        <textarea id="ytContext" placeholder="Tell Claude what to focus on, what you're looking for, or any background context about this video... e.g. 'Analyze the UI design patterns shown' or 'Summarize the key arguments made'" style="width:100%;min-height:80px;padding:12px;padding-right:44px;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:14px;resize:vertical;font-family:inherit;line-height:1.5;"></textarea>
                        <button id="ytVoiceBtn" class="icon-btn" onclick="toggleYtVoiceInput()" title="Voice input" style="position:absolute;right:8px;top:8px;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;background:rgba(0,240,255,0.1);border:1px solid rgba(0,240,255,0.3);">üé§</button>
                    </div>

                    <div id="ytProgress" style="display:none;background:rgba(0,40,60,0.5);border:1px solid var(--border);border-radius:6px;padding:12px;margin-bottom:16px;">
                        <div style="color:var(--accent);margin-bottom:8px;">‚è≥ <span id="ytProgressText">Downloading video...</span></div>
                        <div style="background:var(--bg);height:6px;border-radius:3px;overflow:hidden;">
                            <div id="ytProgressBar" style="background:var(--accent);height:100%;width:0%;transition:width 0.3s;"></div>
                        </div>
                    </div>

                    <div style="display:flex;gap:8px;">
                        <button class="btn success" id="ytDownloadBtn" onclick="downloadYouTube()">Download & Analyze</button>
                        <button class="btn" onclick="closeYouTubeModal()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Diagram Node Popup Modal -->
        <div id="diagramPopupModal" class="diagram-popup-modal" style="display:none;">
            <div class="diagram-popup-content">
                <div class="diagram-popup-header">
                    <h3 id="diagramPopupTitle">Node Details</h3>
                    <button class="diagram-popup-close" onclick="closeDiagramPopup()">&times;</button>
                </div>
                <div class="diagram-popup-body" id="diagramPopupBody">
                    <!-- Content loaded dynamically -->
                </div>
            </div>
        </div>

        <!-- Voice Settings Modal -->
        <div id="voiceModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); z-index:2000; padding:20px; overflow-y:auto;">
            <div style="background:var(--bg-pane); border:1px solid var(--border); border-radius:8px; max-width:700px; margin:0 auto;">
                <div style="padding:16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0;">Voice Settings</h3>
                    <button onclick="closeVoiceSettings()" style="background:none; border:none; color:var(--text); font-size:20px; cursor:pointer;">&times;</button>
                </div>
                <div style="padding:16px;">
                    <!-- Voice Engine Selection -->
                    <div style="margin-bottom:20px; padding:12px; background:var(--bg); border-radius:6px; border:1px solid var(--border);">
                        <label style="display:block; margin-bottom:8px; color:var(--accent); font-weight:600;">Voice Engine:</label>
                        <div style="display:flex; gap:8px;">
                            <button id="engineBrowser" class="btn" onclick="setVoiceEngine('browser')" style="flex:1; padding:10px;">Browser</button>
                            <button id="engineEdgeTTS" class="btn" onclick="setVoiceEngine('edge-tts')" style="flex:1; padding:10px;">Edge TTS</button>
                            <button id="enginePiper" class="btn" onclick="setVoiceEngine('piper')" style="flex:1; padding:10px;">Piper (Local)</button>
                            <button id="engineElevenLabs" class="btn" onclick="setVoiceEngine('elevenlabs')" style="flex:1; padding:10px;">ElevenLabs</button>
                        </div>
                        <p id="engineDescription" style="font-size:11px; color:var(--text-secondary); margin:8px 0 0 0;">Browser voices are instant. Edge TTS uses Microsoft neural voices for higher quality.</p>
                    </div>

                    <!-- Edge TTS Voice Selection (shown when Edge TTS engine is selected) -->
                    <div id="edgeTtsSection" style="display:none; margin-bottom:20px;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                            <div>
                                <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">AXION Edge Voice:</label>
                                <select id="axionEdgeVoice" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;">
                                    <option value="">Loading voices...</option>
                                </select>
                            </div>
                            <div>
                                <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">BRETT Edge Voice:</label>
                                <select id="brettEdgeVoice" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;">
                                    <option value="">Loading voices...</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top:8px; display:flex; gap:8px;">
                            <button class="btn" onclick="testEdgeVoice('axion')">Test AXION Edge</button>
                            <button class="btn" onclick="testEdgeVoice('brett')">Test BRETT Edge</button>
                        </div>
                    </div>

                    <!-- Piper TTS Voice Selection (shown when Piper engine is selected) -->
                    <div id="piperSection" style="display:none; margin-bottom:20px;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                            <div>
                                <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">AXION Piper Voice:</label>
                                <select id="axionPiperVoice" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;">
                                    <optgroup label="US English">
                                        <option value="amy">Amy (Female)</option>
                                        <option value="ryan">Ryan (Male)</option>
                                        <option value="lessac">Lessac (Female)</option>
                                    </optgroup>
                                    <optgroup label="UK English">
                                        <option value="alan">Alan (Male)</option>
                                        <option value="alba">Alba (Female, Scottish)</option>
                                        <option value="cori">Cori (Female)</option>
                                        <option value="jenny_dioco">Jenny (Female)</option>
                                        <option value="northern_english_male">Northern English (Male)</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div>
                                <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">BRETT Piper Voice:</label>
                                <select id="brettPiperVoice" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;">
                                    <optgroup label="US English">
                                        <option value="amy">Amy (Female)</option>
                                        <option value="ryan">Ryan (Male)</option>
                                        <option value="lessac">Lessac (Female)</option>
                                    </optgroup>
                                    <optgroup label="UK English">
                                        <option value="alan">Alan (Male)</option>
                                        <option value="alba">Alba (Female, Scottish)</option>
                                        <option value="cori">Cori (Female)</option>
                                        <option value="jenny_dioco">Jenny (Female)</option>
                                        <option value="northern_english_male">Northern English (Male)</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        <p style="font-size:11px; color:var(--text-secondary); margin:8px 0 0 0;">Piper runs locally on your machine. No API keys, no internet required, completely free.</p>
                        <div style="margin-top:8px; display:flex; gap:8px;">
                            <button class="btn" onclick="testPiperVoice('axion')">Test AXION Piper</button>
                            <button class="btn" onclick="testPiperVoice('brett')">Test BRETT Piper</button>
                        </div>
                    </div>

                    <!-- ElevenLabs Voice Selection (shown when ElevenLabs engine is selected) -->
                    <div id="elevenLabsSection" style="display:none; margin-bottom:20px;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                            <div>
                                <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">AXION ElevenLabs Voice:</label>
                                <select id="axionElevenVoice" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;">
                                    <option value="">Loading voices...</option>
                                </select>
                            </div>
                            <div>
                                <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">BRETT ElevenLabs Voice:</label>
                                <select id="brettElevenVoice" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;">
                                    <option value="">Loading voices...</option>
                                </select>
                            </div>
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:12px;">
                            <div>
                                <label style="display:block; margin-bottom:4px; color:var(--text-secondary); font-size:12px;">Stability: <span id="elevenStabilityVal">0.5</span></label>
                                <input type="range" id="elevenStability" min="0" max="1" step="0.05" value="0.5" style="width:100%;" oninput="document.getElementById('elevenStabilityVal').textContent=this.value">
                            </div>
                            <div>
                                <label style="display:block; margin-bottom:4px; color:var(--text-secondary); font-size:12px;">Similarity: <span id="elevenSimilarityVal">0.75</span></label>
                                <input type="range" id="elevenSimilarity" min="0" max="1" step="0.05" value="0.75" style="width:100%;" oninput="document.getElementById('elevenSimilarityVal').textContent=this.value">
                            </div>
                        </div>
                        <div style="margin-top:8px; display:flex; gap:8px;">
                            <button class="btn" onclick="testElevenLabsVoice('axion')">Test AXION</button>
                            <button class="btn" onclick="testElevenLabsVoice('brett')">Test BRETT</button>
                        </div>
                        <!-- Voice Personality - auto-sets chat personality to match voice character -->
                        <div style="margin-top:12px; padding:10px; background:var(--bg); border-radius:6px; border:1px solid var(--border);">
                            <label style="display:block; margin-bottom:6px; color:var(--accent); font-weight:600; font-size:13px;">Voice Personality:</label>
                            <select id="elevenPersonality" onchange="setElevenPersonality(this.value)" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;">
                                <option value="neutral">Neutral (Standard)</option>
                                <option value="tars">TARS - Witty &amp; Sarcastic (Interstellar)</option>
                                <option value="cheerful">Cheerful - Upbeat &amp; Enthusiastic</option>
                                <option value="business">Business - Professional &amp; Concise</option>
                                <option value="grumpy">Grumpy - Reluctant but Helpful</option>
                                <option value="zen">Zen - Calm &amp; Philosophical</option>
                                <option value="pirate">Pirate - Arr, Sailing the Seas!</option>
                                <option value="hal">HAL 9000 - Calm &amp; Unsettling (2001)</option>
                            </select>
                            <p style="font-size:11px; color:var(--text-secondary); margin:6px 0 0 0;">Sets the AI personality for chat responses. Pairs with the selected voice for full character immersion.</p>
                            <div style="margin-top:10px;">
                                <label style="display:block; margin-bottom:4px; color:var(--text-secondary); font-size:12px;">Custom Personality Prompt: <span style="color:var(--accent); cursor:pointer; font-size:11px;" onclick="resetPersonalityPrompt()">[Reset to Default]</span></label>
                                <textarea id="customPersonalityPrompt" rows="4" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px; font-size:12px; font-family:inherit; resize:vertical;" placeholder="Edit the system prompt that controls how the AI responds..."></textarea>
                                <p style="font-size:11px; color:var(--text-secondary); margin:4px 0 0 0;">This is the system prompt sent with every message. Edit it to change how the AI responds.</p>
                            </div>
                        </div>
                        <p style="font-size:11px; color:var(--text-secondary); margin:8px 0 0 0;">ElevenLabs uses your API credits. Lower stability = more expressive. Higher similarity = closer to original voice.</p>
                    </div>

                    <!-- Browser Voice Selection (shown when Browser engine is selected) -->
                    <div id="browserVoiceSection" style="margin-bottom:20px;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:20px;">
                            <div>
                                <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">AXION Voice:</label>
                                <select id="axionVoice" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;"></select>
                            </div>
                            <div>
                                <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">BRETT Voice:</label>
                                <select id="brettVoice" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;"></select>
                            </div>
                        </div>
                        <!-- Voice Tuning - Pitch & Rate (browser only) -->
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:20px;">
                            <div>
                                <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">AXION Pitch: <span id="axionPitchVal">1.0</span></label>
                                <input type="range" id="axionPitch" min="0.5" max="1.5" step="0.1" value="1.0" style="width:100%;" oninput="document.getElementById('axionPitchVal').textContent=this.value">
                            </div>
                            <div>
                                <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">AXION Rate: <span id="axionRateVal">1.0</span></label>
                                <input type="range" id="axionRate" min="0.5" max="1.5" step="0.1" value="1.0" style="width:100%;" oninput="document.getElementById('axionRateVal').textContent=this.value">
                            </div>
                        </div>
                        <!-- Voice Presets (browser only) -->
                        <div style="margin-bottom:20px;">
                            <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">Voice Presets:</label>
                            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                <button class="btn" onclick="applyVoicePreset('default')">Default</button>
                                <button class="btn" onclick="applyVoicePreset('hal')">HAL 9000</button>
                                <button class="btn" onclick="applyVoicePreset('calm')">Calm</button>
                                <button class="btn" onclick="applyVoicePreset('fast')">Fast</button>
                            </div>
                        </div>
                        <div style="display:flex; gap:8px; flex-wrap:wrap;">
                            <button class="btn" onclick="testVoice('axion')">Test AXION</button>
                            <button class="btn" onclick="testVoice('brett')">Test BRETT</button>
                        </div>
                    </div>

                    <!-- Shared Personality Section (for non-ElevenLabs engines) -->
                    <div id="sharedPersonalitySection" style="display:none; margin-bottom:20px;">
                        <div style="padding:12px; background:var(--bg); border-radius:6px; border:1px solid var(--border);">
                            <label style="display:block; margin-bottom:6px; color:var(--accent); font-weight:600; font-size:13px;">Voice Personality:</label>
                            <select id="sharedPersonality" onchange="setSharedPersonality(this.value)" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px; margin-bottom:10px;">
                                <option value="neutral">Neutral (Standard)</option>
                                <option value="tars">TARS - Witty &amp; Sarcastic (Interstellar)</option>
                                <option value="cheerful">Cheerful - Upbeat &amp; Enthusiastic</option>
                                <option value="business">Business - Professional &amp; Concise</option>
                                <option value="grumpy">Grumpy - Reluctant but Helpful</option>
                                <option value="zen">Zen - Calm &amp; Philosophical</option>
                                <option value="pirate">Pirate - Arr, Sailing the Seas!</option>
                                <option value="hal">HAL 9000 - Calm &amp; Unsettling (2001)</option>
                            </select>
                            <label style="display:block; margin-bottom:4px; color:var(--text-secondary); font-size:12px;">Custom Personality Prompt: <span style="color:var(--accent); cursor:pointer; font-size:11px;" onclick="resetSharedPersonalityPrompt()">[Reset to Default]</span></label>
                            <textarea id="sharedCustomPrompt" rows="4" style="width:100%; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px; font-size:12px; font-family:inherit; resize:vertical;" placeholder="Edit the system prompt that controls how the AI responds..."></textarea>
                            <p style="font-size:11px; color:var(--text-secondary); margin:4px 0 0 0;">This personality applies to Edge TTS, Piper, and Browser TTS engines.</p>
                        </div>
                    </div>

                    <!-- Save button (always visible) -->
                    <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:24px;">
                        <button class="btn primary" onclick="saveVoiceSettings()">Save</button>
                    </div>

                    <!-- Voice Commands Reference -->
                    <div style="border-top:1px solid var(--border); padding-top:16px;">
                        <h4 style="margin:0 0 12px 0; color:var(--accent);">üìã Voice Commands Reference</h4>
                        <div style="max-height:200px; overflow-y:auto; background:var(--bg); border-radius:6px; padding:12px;">
                            <table style="width:100%; font-size:13px; border-collapse:collapse;">
                                <thead>
                                    <tr style="color:var(--text-secondary); text-align:left;">
                                        <th style="padding:4px 8px; border-bottom:1px solid var(--border);">Command</th>
                                        <th style="padding:4px 8px; border-bottom:1px solid var(--border);">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="voiceCommandsTable">
                                    <tr><td style="padding:4px 8px;">run send</td><td style="padding:4px 8px; color:var(--text-secondary);">Send message</td></tr>
                                    <tr><td style="padding:4px 8px;">run clear</td><td id="helpClearInput" style="padding:4px 8px; color:var(--text-secondary);">Clear Brett input</td></tr>
                                    <tr><td style="padding:4px 8px;">run format</td><td style="padding:4px 8px; color:var(--text-secondary);">Format text</td></tr>
                                    <tr><td style="padding:4px 8px;">run read</td><td id="helpReadInput" style="padding:4px 8px; color:var(--text-secondary);">Read Brett aloud</td></tr>
                                    <tr><td style="padding:4px 8px;">run stop</td><td style="padding:4px 8px; color:var(--text-secondary);">Stop current job</td></tr>
                                    <tr><td style="padding:4px 8px;">run refresh</td><td style="padding:4px 8px; color:var(--text-secondary);">Refresh page</td></tr>
                                    <tr><td style="padding:4px 8px;">run fullscreen</td><td style="padding:4px 8px; color:var(--text-secondary);">Enter fullscreen</td></tr>
                                    <tr><td style="padding:4px 8px;">run commit</td><td style="padding:4px 8px; color:var(--text-secondary);">Open Git modal</td></tr>
                                    <tr><td style="padding:4px 8px;">run review task</td><td style="padding:4px 8px; color:var(--text-secondary);">Run /reviewtask</td></tr>
                                    <tr><td style="padding:4px 8px;">run explain</td><td style="padding:4px 8px; color:var(--text-secondary);">Run /explain</td></tr>
                                    <tr><td style="padding:4px 8px;">run implement</td><td style="padding:4px 8px; color:var(--text-secondary);">Run /implement</td></tr>
                                    <tr><td style="padding:4px 8px;">run [project]</td><td style="padding:4px 8px; color:var(--text-secondary);">Open project in new tab</td></tr>
                                    <tr><td style="padding:4px 8px;">axion clear</td><td style="padding:4px 8px; color:var(--text-secondary);">Clear Axion display</td></tr>
                                    <tr><td style="padding:4px 8px;">axion read</td><td id="helpAxionRead" style="padding:4px 8px; color:var(--text-secondary);">Read Axion aloud (pauses Brett voice)</td></tr>
                                    <tr><td style="padding:4px 8px;">axion read stop</td><td style="padding:4px 8px; color:var(--text-secondary);">Stop Axion reading</td></tr>
                                    <tr><td style="padding:4px 8px;">axion screenshots</td><td style="padding:4px 8px; color:var(--text-secondary);">Open screenshots</td></tr>
                                    <tr><td style="padding:4px 8px;">open [project]</td><td style="padding:4px 8px; color:var(--text-secondary);">Switch project</td></tr>
                                    <tr><td style="padding:4px 8px;">stop read</td><td style="padding:4px 8px; color:var(--text-secondary);">Stop any reading</td></tr>
                                    <tr><td style="padding:4px 8px;">stop voice</td><td style="padding:4px 8px; color:var(--text-secondary);">Commands only mode</td></tr>
                                    <tr><td style="padding:4px 8px;">start voice</td><td style="padding:4px 8px; color:var(--text-secondary);">Full dictation mode</td></tr>
                                    <tr><td style="padding:4px 8px;">run voice</td><td style="padding:4px 8px; color:var(--text-secondary);">Full dictation mode</td></tr>
                                    <tr><td style="padding:4px 8px;">stop fullscreen</td><td style="padding:4px 8px; color:var(--text-secondary);">Exit fullscreen</td></tr>
                                    <tr><td colspan="2" style="padding:8px 8px 4px 8px; color:var(--accent); font-weight:bold; border-top:1px solid var(--border);">Text Editing</td></tr>
                                    <tr><td style="padding:4px 8px;">delete last word</td><td style="padding:4px 8px; color:var(--text-secondary);">Remove last word</td></tr>
                                    <tr><td style="padding:4px 8px;">delete all</td><td style="padding:4px 8px; color:var(--text-secondary);">Clear all text</td></tr>
                                    <tr><td style="padding:4px 8px;">delete last sentence</td><td style="padding:4px 8px; color:var(--text-secondary);">Remove last sentence</td></tr>
                                    <tr><td style="padding:4px 8px;">undo</td><td style="padding:4px 8px; color:var(--text-secondary);">Undo last change</td></tr>
                                    <tr><td style="padding:4px 8px;">new line</td><td style="padding:4px 8px; color:var(--text-secondary);">Insert line break</td></tr>
                                    <tr><td style="padding:4px 8px;">new paragraph</td><td style="padding:4px 8px; color:var(--text-secondary);">Insert two line breaks</td></tr>
                                    <tr><td style="padding:4px 8px;">go to line [N]</td><td style="padding:4px 8px; color:var(--text-secondary);">Move cursor to line N</td></tr>
                                    <tr><td colspan="2" style="padding:8px 8px 4px 8px; color:var(--accent); font-weight:bold; border-top:1px solid var(--border);">Lists</td></tr>
                                    <tr><td style="padding:4px 8px;">bullet point</td><td style="padding:4px 8px; color:var(--text-secondary);">Start bullet list mode</td></tr>
                                    <tr><td style="padding:4px 8px;">stop bullet</td><td style="padding:4px 8px; color:var(--text-secondary);">Exit bullet list mode</td></tr>
                                    <tr><td style="padding:4px 8px;">numbered list</td><td style="padding:4px 8px; color:var(--text-secondary);">Start numbered list mode</td></tr>
                                    <tr><td style="padding:4px 8px;">stop numbered</td><td style="padding:4px 8px; color:var(--text-secondary);">Exit numbered list mode</td></tr>
                                    <tr><td colspan="2" style="padding:8px 8px 4px 8px; color:var(--accent); font-weight:bold; border-top:1px solid var(--border);">File Browser</td></tr>
                                    <tr><td style="padding:4px 8px;">open editor</td><td style="padding:4px 8px; color:var(--text-secondary);">Open file browser</td></tr>
                                    <tr><td style="padding:4px 8px;">close editor</td><td style="padding:4px 8px; color:var(--text-secondary);">Close file browser</td></tr>
                                    <tr><td style="padding:4px 8px;">save file</td><td style="padding:4px 8px; color:var(--text-secondary);">Save current file</td></tr>
                                    <tr><td style="padding:4px 8px;">read file</td><td style="padding:4px 8px; color:var(--text-secondary);">Read file aloud</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Custom Aliases -->
                    <div style="border-top:1px solid var(--border); padding-top:16px; margin-top:16px;">
                        <h4 style="margin:0 0 12px 0; color:var(--accent);">üéØ Custom Voice Aliases</h4>
                        <p style="font-size:12px; color:var(--text-secondary); margin-bottom:12px;">Add alternate phrases that trigger the same command (e.g., "run sen" ‚Üí "run send")</p>
                        <div style="display:flex; gap:8px; margin-bottom:12px;">
                            <input type="text" id="aliasPhrase" placeholder="Spoken phrase (e.g., run sen)" style="flex:1; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;">
                            <select id="aliasCommand" style="flex:1; padding:8px; background:var(--bg-input); border:1px solid var(--border); color:var(--text); border-radius:4px;">
                                <option value="">Select command...</option>
                                <optgroup label="Actions">
                                    <option value="run send">run send</option>
                                    <option value="run clear">run clear</option>
                                    <option value="run format">run format</option>
                                    <option value="run read">run read</option>
                                    <option value="run stop">run stop</option>
                                    <option value="run refresh">run refresh</option>
                                    <option value="run fullscreen">run fullscreen</option>
                                    <option value="run commit">run commit</option>
                                    <option value="run review task">run review task</option>
                                    <option value="run explain">run explain</option>
                                    <option value="run implement">run implement</option>
                                </optgroup>
                                <optgroup label="Axion">
                                    <option value="axion clear">axion clear</option>
                                    <option value="axion read">axion read</option>
                                    <option value="axion read stop">axion read stop</option>
                                    <option value="axion screenshots">axion screenshots</option>
                                </optgroup>
                                <optgroup label="Control">
                                    <option value="stop read">stop read</option>
                                    <option value="stop voice">stop voice</option>
                                    <option value="start voice">start voice</option>
                                    <option value="run voice">run voice</option>
                                    <option value="stop fullscreen">stop fullscreen</option>
                                </optgroup>
                                <optgroup label="Text Editing">
                                    <option value="delete last word">delete last word</option>
                                    <option value="delete all">delete all</option>
                                    <option value="delete last sentence">delete last sentence</option>
                                    <option value="undo">undo</option>
                                    <option value="new line">new line</option>
                                    <option value="new paragraph">new paragraph</option>
                                </optgroup>
                                <optgroup label="Lists">
                                    <option value="bullet point">bullet point</option>
                                    <option value="stop bullet">stop bullet</option>
                                    <option value="numbered list">numbered list</option>
                                    <option value="stop numbered">stop numbered</option>
                                </optgroup>
                                <optgroup label="File Browser">
                                    <option value="open editor">open editor</option>
                                    <option value="close editor">close editor</option>
                                    <option value="save file">save file</option>
                                    <option value="read file">read file</option>
                                </optgroup>
                            </select>
                            <button class="btn primary" onclick="addVoiceAlias()" style="padding:8px 16px;">Add</button>
                        </div>
                        <div id="aliasesList" style="background:var(--bg); border-radius:6px; padding:8px; min-height:40px;">
                            <span style="color:var(--text-secondary); font-size:12px;">No custom aliases yet</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Git Modal -->
        <div id="gitModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); z-index:2000; padding:40px;">
            <div style="background:var(--bg-pane); border:1px solid var(--border); border-radius:8px; max-width:600px; margin:0 auto; max-height:90vh; display:flex; flex-direction:column;">
                <div style="padding:16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0;">Git Operations</h3>
                    <button onclick="closeGitModal()" style="background:none; border:none; color:var(--text); font-size:20px; cursor:pointer;">&times;</button>
                </div>
                <div style="padding:16px; flex:1; overflow-y:auto;">
                    <div style="margin-bottom:16px; display:flex; align-items:center; gap:16px; flex-wrap:wrap;">
                        <div>
                            <label style="display:block; margin-bottom:4px; color:var(--text-secondary); font-size:12px;">Project:</label>
                            <span id="gitProject" style="color:var(--accent); font-weight:bold;">-</span>
                        </div>
                        <div>
                            <label style="display:block; margin-bottom:4px; color:var(--text-secondary); font-size:12px;">Branch:</label>
                            <select id="gitBranchSelect" class="git-branch-select" onchange="switchBranchFromDropdown(this.value)">
                                <option value="">Loading...</option>
                            </select>
                        </div>
                    </div>

                    <div style="display:flex; gap:8px; margin-bottom:16px; flex-wrap:wrap;">
                        <button class="btn" onclick="gitStatus()" id="gitStatusBtn">Status</button>
                        <button class="btn primary" onclick="gitCommit()" id="gitCommitBtn">Commit & Push</button>
                        <button class="btn" onclick="openGitPullModal()" id="gitPullBtn">Pull Changes</button>
                        <button class="btn" onclick="openGitMergeModal()" id="gitMergeBtn">Merge From</button>
                        <button class="btn" onclick="openGitBranchModal()" id="gitBranchBtn">Branches</button>
                        <button class="btn" onclick="openGitLogModal()" id="gitLogBtn">History</button>
                    </div>
                    <div style="display:flex; gap:8px; margin-bottom:16px; flex-wrap:wrap; border-top:1px solid var(--border); padding-top:12px;">
                        <button class="btn" onclick="gitStash()" id="gitStashBtn" title="Save current changes to stash">üì¶ Stash</button>
                        <button class="btn" onclick="gitStashPop()" id="gitStashPopBtn" title="Restore changes from stash">üì§ Pop Stash</button>
                        <button class="btn danger" onclick="gitRevertAll()" id="gitRevertBtn" title="Discard all uncommitted changes">‚ö†Ô∏è Revert All</button>
                        <button class="btn" onclick="openConflictModal()" id="gitConflictBtn" title="Resolve merge conflicts" style="background:rgba(168,85,247,0.2); border-color:var(--purple); color:var(--purple);">‚ö° Resolve Conflicts</button>
                    </div>

                    <div style="margin-bottom:8px; color:var(--text-secondary);">Output:</div>
                    <pre id="gitOutput" style="background:var(--bg); border:1px solid var(--border); border-radius:4px; padding:12px; margin:0; white-space:pre-wrap; word-wrap:break-word; font-size:12px; max-height:300px; overflow-y:auto; color:var(--text);">Ready for Git commands...</pre>
                </div>
            </div>
        </div>

        <!-- Git Pull Confirmation Modal -->
        <div id="gitPullModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); z-index:2100; padding:40px;">
            <div style="background:var(--bg-pane); border:1px solid var(--border); border-radius:8px; max-width:500px; margin:0 auto; display:flex; flex-direction:column;">
                <div style="padding:16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0;">Pull from Remote</h3>
                    <button onclick="closeGitPullModal()" style="background:none; border:none; color:var(--text); font-size:20px; cursor:pointer;">&times;</button>
                </div>
                <div style="padding:16px;">
                    <div style="margin-bottom:16px; display:flex; gap:16px; flex-wrap:wrap;">
                        <div>
                            <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">Project:</label>
                            <span id="gitPullProject" style="color:var(--accent); font-weight:bold;">-</span>
                        </div>
                        <div style="flex:1; min-width:150px;">
                            <label style="display:block; margin-bottom:8px; color:var(--text-secondary);">Pull from branch:</label>
                            <select id="gitPullBranchSelect" class="git-branch-select" style="width:100%;">
                                <option value="">Loading...</option>
                            </select>
                        </div>
                    </div>

                    <div id="gitPullInfo" style="background:var(--bg); border:1px solid var(--border); border-radius:4px; padding:12px; margin-bottom:16px;">
                        <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                            <span style="color:var(--text-secondary);">Into:</span>
                            <span id="gitPullCurrentBranch" style="color:var(--success); font-weight:bold; font-family:'JetBrains Mono',monospace;">-</span>
                        </div>
                        <div id="gitPullRemote" style="color:var(--text-secondary); font-size:12px;"></div>
                    </div>

                    <div style="display:flex; gap:8px; justify-content:flex-end;">
                        <button class="btn" onclick="closeGitPullModal()">Cancel</button>
                        <button class="btn primary" onclick="executePull()" id="gitPullExecuteBtn">Pull Changes</button>
                    </div>

                    <div id="gitPullOutput" style="margin-top:16px; display:none;">
                        <div style="margin-bottom:8px; color:var(--text-secondary);">Output:</div>
                        <pre id="gitPullResult" style="background:var(--bg); border:1px solid var(--border); border-radius:4px; padding:12px; margin:0; white-space:pre-wrap; word-wrap:break-word; font-size:12px; max-height:200px; overflow-y:auto; color:var(--text);"></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Git Merge Modal -->
        <div id="gitMergeModal" class="modal-overlay" style="display:none;">
            <div class="git-merge-container">
                <div class="git-merge-header">
                    <h3>Merge Branch</h3>
                    <button class="icon-btn" onclick="closeGitMergeModal()" title="Close">&times;</button>
                </div>
                <div class="git-merge-body">
                    <div class="git-merge-info">
                        <div class="git-merge-current">
                            <label>Current Branch:</label>
                            <span id="gitMergeCurrentBranch" class="git-merge-branch-name">-</span>
                        </div>
                        <div class="git-merge-arrow">‚Üê</div>
                        <div class="git-merge-source">
                            <label>Merge From:</label>
                            <select id="gitMergeSourceBranch" class="git-branch-select">
                                <option value="">Select branch...</option>
                            </select>
                        </div>
                    </div>
                    <div class="git-merge-options">
                        <label class="git-merge-checkbox">
                            <input type="checkbox" id="gitMergeNoFf">
                            <span>Create merge commit (--no-ff)</span>
                        </label>
                    </div>
                    <div class="git-merge-actions">
                        <button class="btn" onclick="closeGitMergeModal()">Cancel</button>
                        <button class="btn primary" onclick="executeMerge()" id="gitMergeExecuteBtn">Merge</button>
                    </div>
                    <div id="gitMergeStatus" class="git-merge-status" style="display:none;"></div>
                </div>
            </div>
        </div>

        <!-- Git Log Viewer Modal -->
        <div id="gitLogModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); z-index:2100; padding:20px;">
            <div style="background:var(--bg-pane); border:1px solid var(--border); border-radius:8px; width:90%; max-width:1000px; height:90vh; margin:0 auto; display:flex; flex-direction:column;">
                <div style="padding:16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <h3 style="margin:0;">Git History</h3>
                        <div id="gitLogBranch" style="color:var(--text-secondary); font-size:12px; margin-top:4px;"></div>
                    </div>
                    <button onclick="closeGitLogModal()" style="background:none; border:none; color:var(--text); font-size:20px; cursor:pointer;">&times;</button>
                </div>
                <div style="padding:16px; flex:1; overflow:hidden; display:flex; flex-direction:column;">
                    <div style="display:flex; gap:8px; margin-bottom:16px; align-items:center;">
                        <button class="btn" onclick="refreshGitLog()" id="gitLogRefreshBtn">Refresh</button>
                        <span id="gitLogCount" style="color:var(--text-secondary); font-size:12px; margin-left:auto;"></span>
                    </div>

                    <div id="gitLogContainer" style="flex:1; overflow-y:auto; border:1px solid var(--border); border-radius:4px; background:var(--bg);">
                        <div id="gitLogLoading" style="padding:40px; text-align:center; color:var(--text-secondary);">Loading commit history...</div>
                        <div id="gitLogContent" style="display:none;"></div>
                        <div id="gitLogError" style="display:none; padding:20px; text-align:center; color:var(--error);"></div>
                    </div>

                    <div id="gitLogPagination" style="margin-top:12px; text-align:center; display:none;">
                        <button class="btn" onclick="loadMoreCommits()" id="gitLogLoadMore">Load More Commits</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Git Conflict Resolution Modal -->
        <div id="gitConflictModal" class="modal-overlay" style="display:none;">
            <div class="conflict-resolution-container">
                <div class="conflict-header">
                    <div class="conflict-header-left">
                        <h3>Merge Conflicts</h3>
                        <span id="conflictProjectName" class="conflict-project"></span>
                    </div>
                    <div class="conflict-header-right">
                        <span id="conflictCount" class="conflict-badge">0 conflicts</span>
                        <button class="icon-btn" onclick="closeConflictModal()" title="Close">&times;</button>
                    </div>
                </div>

                <div class="conflict-body">
                    <!-- File List Sidebar -->
                    <div class="conflict-file-list">
                        <div class="conflict-file-header">Conflicted Files</div>
                        <div id="conflictFileList" class="conflict-files"></div>
                        <div class="conflict-actions-bottom">
                            <button class="btn danger" onclick="abortMerge()" title="Abort merge and return to previous state">Abort Merge</button>
                            <button class="btn primary" id="completeMergeBtn" onclick="completeMerge()" disabled title="Complete merge after resolving all conflicts">Complete Merge</button>
                        </div>
                    </div>

                    <!-- Main Conflict Viewer -->
                    <div class="conflict-viewer">
                        <!-- Toolbar -->
                        <div class="conflict-toolbar">
                            <div class="conflict-file-name">
                                <span id="currentConflictFile">Select a file to resolve</span>
                            </div>
                            <div class="conflict-resolution-btns">
                                <button class="btn" onclick="resolveConflict('ours')" title="Use current branch version">Use Ours (Local)</button>
                                <button class="btn" onclick="resolveConflict('theirs')" title="Use incoming branch version">Use Theirs (Remote)</button>
                                <button class="btn primary" onclick="aiResolveConflict()" id="aiResolveBtn" title="Let AI intelligently merge the changes">AI Resolve</button>
                            </div>
                        </div>

                        <!-- Side-by-Side Diff Viewer -->
                        <div class="conflict-diff-container">
                            <div class="conflict-diff-pane ours-pane">
                                <div class="diff-pane-header">
                                    <span class="diff-label ours">OURS (Local/HEAD)</span>
                                    <button class="btn btn-small" onclick="copyDiffPane('ours')" title="Copy content">Copy</button>
                                </div>
                                <pre id="conflictOurs" class="diff-content"></pre>
                            </div>
                            <div class="conflict-diff-pane theirs-pane">
                                <div class="diff-pane-header">
                                    <span class="diff-label theirs">THEIRS (Remote/Incoming)</span>
                                    <button class="btn btn-small" onclick="copyDiffPane('theirs')" title="Copy content">Copy</button>
                                </div>
                                <pre id="conflictTheirs" class="diff-content"></pre>
                            </div>
                        </div>

                        <!-- Custom Resolution Editor (hidden by default) -->
                        <div id="customResolveSection" class="custom-resolve-section" style="display:none;">
                            <div class="custom-resolve-header">
                                <span>Custom Resolution (edit and apply)</span>
                                <div class="custom-resolve-btns">
                                    <button class="btn" onclick="cancelCustomResolve()">Cancel</button>
                                    <button class="btn primary" onclick="applyCustomResolve()">Apply Resolution</button>
                                </div>
                            </div>
                            <textarea id="customResolveEditor" class="custom-resolve-editor" spellcheck="false"></textarea>
                        </div>

                        <!-- AI Resolution Preview (hidden by default) -->
                        <div id="aiResolvePreview" class="ai-resolve-preview" style="display:none;">
                            <div class="ai-resolve-header">
                                <span>AI Resolution Preview</span>
                                <div class="ai-resolve-btns">
                                    <button class="btn" onclick="rejectAiResolve()">Reject</button>
                                    <button class="btn" onclick="editAiResolve()">Edit</button>
                                    <button class="btn primary" onclick="acceptAiResolve()">Accept & Apply</button>
                                </div>
                            </div>
                            <pre id="aiResolveContent" class="ai-resolve-content"></pre>
                        </div>

                        <!-- Status Messages -->
                        <div id="conflictStatus" class="conflict-status" style="display:none;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Git Branch Management Modal -->
        <div id="gitBranchModal" class="modal-overlay" style="display:none;">
            <div class="git-branch-container">
                <div class="git-branch-header">
                    <div>
                        <h3>Branch Management</h3>
                        <div id="gitBranchProject" class="git-branch-project"></div>
                    </div>
                    <div class="git-branch-header-controls">
                        <button class="icon-btn" onclick="fetchBranches()" title="Fetch from remote">‚ü≥</button>
                        <button class="icon-btn" onclick="closeGitBranchModal()" title="Close">&times;</button>
                    </div>
                </div>
                <div class="git-branch-body">
                    <!-- Current Branch Display -->
                    <div class="git-current-branch">
                        <span class="git-current-label">Current:</span>
                        <span id="gitCurrentBranch" class="git-current-name">-</span>
                        <button class="btn btn-small" onclick="pushCurrentBranch()" id="pushBranchBtn" title="Push to remote">Push</button>
                    </div>

                    <!-- Create New Branch -->
                    <div class="git-create-branch">
                        <input type="text" id="newBranchName" placeholder="New branch name..." class="git-branch-input">
                        <button class="btn primary btn-small" onclick="createBranch()" id="createBranchBtn">Create & Switch</button>
                    </div>

                    <!-- Branch Tabs -->
                    <div class="git-branch-tabs">
                        <button class="git-branch-tab active" data-tab="local" onclick="switchBranchTab('local')">Local</button>
                        <button class="git-branch-tab" data-tab="remote" onclick="switchBranchTab('remote')">Remote</button>
                    </div>

                    <!-- Branch Lists -->
                    <div class="git-branch-list-container">
                        <div id="gitLocalBranches" class="git-branch-list">
                            <div class="git-branch-loading">Loading branches...</div>
                        </div>
                        <div id="gitRemoteBranches" class="git-branch-list" style="display:none;">
                            <div class="git-branch-loading">Loading branches...</div>
                        </div>
                    </div>

                    <!-- Status/Output -->
                    <div id="gitBranchStatus" class="git-branch-status" style="display:none;"></div>
                </div>
            </div>
        </div>

        <!-- File Browser Modal -->
        <div id="fileBrowserModal" class="modal-overlay" style="display:none;">
            <div class="file-browser-container">
                <div class="file-browser-header">
                    <h3>File Browser - <span id="fileBrowserProject">-</span></h3>
                    <!-- Mobile Tab Switcher -->
                    <div class="fb-mobile-tabs" id="fbMobileTabs">
                        <button class="fb-tab active" data-tab="files" onclick="switchFileBrowserTab('files')">üìÅ Files</button>
                        <button class="fb-tab" data-tab="source" onclick="switchFileBrowserTab('source')">üìÑ Source</button>
                        <button class="fb-tab" data-tab="explain" onclick="switchFileBrowserTab('explain')">üí° Explain</button>
                    </div>
                    <div class="file-browser-controls">
                        <button class="icon-btn" onclick="refreshFileTree()" title="Refresh">‚Üª</button>
                        <button class="icon-btn" onclick="closeFileBrowser()" title="Close">&times;</button>
                    </div>
                </div>
                <div class="file-browser-body">
                    <!-- File Tree Panel -->
                    <div class="file-tree-panel">
                        <div class="file-tree-search">
                            <input type="text" id="fileTreeFilter" placeholder="Filter files..." oninput="filterFileTree(this.value)">
                        </div>
                        <div id="fileTreeContainer" class="file-tree-container">
                            <div class="file-tree-loading">Select a project to browse files</div>
                        </div>
                    </div>
                    <!-- Editor Panel -->
                    <div class="editor-panel" id="editorPanel">
                        <div class="editor-header" ondblclick="toggleEditorFullscreen(event)">
                            <span id="editorFilePath" class="editor-file-path">No file open</span>
                            <div class="editor-controls">
                                <span id="editorStatus" class="editor-status"></span>
                                <button class="icon-btn" onclick="undoEdit()" title="Undo (Ctrl+Z)">‚Ü∂</button>
                                <button class="icon-btn" onclick="redoEdit()" title="Redo (Ctrl+Y)">‚Ü∑</button>
                                <button class="icon-btn" onclick="readFileAloud()" title="Read aloud">üîä</button>
                                <button class="icon-btn" onclick="toggleExplainPanel()" title="Explain file" id="explainBtn">üí°</button>
                                <button class="icon-btn primary" onclick="saveFile()" title="Save (Ctrl+S)">üíæ</button>
                                <button class="icon-btn" onclick="toggleEditorFullscreen()" title="Fullscreen" id="editorFullscreenBtn">‚õ∂</button>
                            </div>
                        </div>
                        <div class="editor-content-wrapper">
                            <div id="editorLineNumbers" class="editor-line-numbers">1</div>
                            <div class="editor-highlight-container">
                                <pre id="editorHighlight" class="editor-highlight"><code id="editorHighlightCode"></code></pre>
                                <textarea id="editorTextarea" class="editor-textarea" spellcheck="false" placeholder="Select a file to edit..."></textarea>
                            </div>
                        </div>
                        <!-- Modification now handled via Q&A panel in Explain -->
                    </div>
                    <!-- Explain Panel -->
                    <div class="explain-panel" id="explainPanel" style="display:none;">
                        <div class="explain-header" ondblclick="toggleExplainFullscreen(event)">
                            <span class="explain-title">üí° File Explanation</span>
                            <span id="explainStatus" class="explain-status"></span>
                            <span id="explainTimestamp" class="explain-timestamp"></span>
                            <div class="explain-controls">
                                <button class="icon-btn" onclick="readExplanationAloud()" title="Read explanation aloud">üîä</button>
                                <button class="icon-btn" onclick="toggleQaPanel()" title="Ask questions about this file">üí¨</button>
                                <button class="icon-btn" onclick="refreshExplanation()" title="Refresh explanation">üîÑ</button>
                                <button class="icon-btn" onclick="toggleExplainFullscreen()" title="Fullscreen" id="explainFullscreenBtn">‚õ∂</button>
                                <button class="icon-btn" onclick="toggleExplainPanel()" title="Close">‚úï</button>
                            </div>
                        </div>
                        <div class="explain-content" id="explainContent">
                            <div class="explain-placeholder">Open a file to see its explanation</div>
                        </div>
                        <!-- Q&A Panel -->
                        <div class="qa-panel" id="qaPanel" style="display:none;">
                            <div class="qa-header">
                                <span class="qa-title">üí¨ Ask About This File</span>
                                <div class="qa-controls">
                                    <button class="icon-btn active" id="qaAutoReadBtn" onclick="toggleQaAutoRead()" title="AI voice response: ON" style="background:var(--success);border-color:var(--success);">üéß</button>
                                    <button class="icon-btn" id="qaVoiceBtn" onclick="toggleQaVoice()" title="Voice input">üé§</button>
                                    <button class="icon-btn" onclick="clearQaHistory()" title="Clear history">üóëÔ∏è</button>
                                    <button class="icon-btn" onclick="toggleQaPanel()" title="Close Q&A">‚úï</button>
                                </div>
                            </div>
                            <div class="qa-history" id="qaHistory">
                                <div class="qa-message assistant">Ask any question about this file. I'll help you understand it better!</div>
                            </div>
                            <div class="qa-input-area">
                                <input type="text" id="qaInput" placeholder="Ask a question about this file..." onkeydown="handleQaKeydown(event)">
                                <button class="icon-btn primary" onclick="submitQaQuestion()" title="Send">‚ñ∂</button>
                            </div>
                        </div>
                    </div>
                    <!-- Diff Modal -->
                    <div id="diffModal" class="diff-modal" style="display:none;">
                        <div class="diff-header">
                            <h3>üìù Proposed Changes</h3>
                            <div class="diff-stats">
                                <span class="diff-added">+<span id="diffAddedCount">0</span> lines</span>
                                <span class="diff-removed">-<span id="diffRemovedCount">0</span> lines</span>
                            </div>
                            <div class="diff-controls">
                                <button class="icon-btn" onclick="readDiffAloud()" title="Read changes aloud">üîä</button>
                                <button class="icon-btn" onclick="closeDiffModal()" title="Close">‚úï</button>
                            </div>
                        </div>
                        <div class="diff-explanation" id="diffExplanation">
                            Changes will be explained here...
                        </div>
                        <div class="diff-container">
                            <div class="diff-pane">
                                <div class="diff-pane-header">Original</div>
                                <div class="diff-content" id="diffOriginal"></div>
                            </div>
                            <div class="diff-pane">
                                <div class="diff-pane-header">Proposed</div>
                                <div class="diff-content" id="diffProposed"></div>
                            </div>
                        </div>
                        <div class="diff-actions">
                            <button class="btn danger" onclick="revertChanges()">‚úï Revert</button>
                            <button class="btn success" onclick="acceptChanges()">‚úì Accept Changes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Keyboard shortcuts hint -->
        <div id="shortcutsHint" class="shortcuts-hint">
            <kbd>Ctrl</kbd>+<kbd>Enter</kbd> Send | <kbd>Esc</kbd> Close | <kbd>Ctrl</kbd>+<kbd>/</kbd> Sidebar
        </div>

        <!-- Image Lightbox with navigation -->
        <div id="imageLightbox" class="image-lightbox" onclick="closeLightbox()">
            <button class="lightbox-close" onclick="closeLightbox()" title="Close (Esc)">&times;</button>
            <button id="lightboxPrev" class="lightbox-nav lightbox-prev" onclick="event.stopPropagation(); navigateLightbox(-1)" title="Previous (‚Üê)">&#10094;</button>
            <img id="lightboxImage" src="" alt="Full size image" onclick="event.stopPropagation()" style="cursor:default;">
            <button id="lightboxNext" class="lightbox-nav lightbox-next" onclick="event.stopPropagation(); navigateLightbox(1)" title="Next (‚Üí)">&#10095;</button>
            <div id="lightboxCounter" class="lightbox-counter">1 / 1</div>
        </div>

        <!-- Skills Popup Modal -->
        <div id="skillsOverlay" class="skills-overlay" onclick="toggleSkillsPanel()" style="display:none;"></div>
        <div id="skillsPanel" class="skills-popup" style="display:none;">
            <div class="skills-popup-header">
                <div class="skills-popup-title">
                    <span class="skills-title-icon">‚ö°</span>
                    <span>Skills</span>
                </div>
                <input type="text" id="skillsSearch" class="skills-popup-search" placeholder="Search skills..." oninput="filterSkills(event)">
                <button class="skills-popup-close" onclick="toggleSkillsPanel()">&times;</button>
            </div>

            <!-- Selected Skills Area -->
            <div id="selectedSkillsArea" class="selected-skills-area" style="display:none;">
                <div class="selected-skills-header">
                    <span class="selected-label">Selected Skills</span>
                    <button class="clear-all-btn" onclick="clearAllSkills()">Clear All</button>
                </div>
                <div id="selectedSkillsList" class="selected-skills-list"></div>
            </div>

            <div class="skills-popup-content">
                <!-- Planning & Analysis -->
                <div class="skills-section">
                    <div class="skills-section-title">üß† Planning & Analysis</div>
                    <div class="skills-grid">
                        <div class="skill-card" data-skill="/brainstorm" onclick="toggleSkill('/brainstorm')">
                            <div class="skill-card-icon">üí≠</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">brainstorm</div>
                                <div class="skill-card-desc">Explore ideas before implementation</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/write-plan" onclick="toggleSkill('/write-plan')">
                            <div class="skill-card-icon">üìù</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">write-plan</div>
                                <div class="skill-card-desc">Create detailed implementation plan</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/execute-plan" onclick="toggleSkill('/execute-plan')">
                            <div class="skill-card-icon">‚ñ∂Ô∏è</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">execute-plan</div>
                                <div class="skill-card-desc">Execute plan with checkpoints</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/prime" onclick="toggleSkill('/prime')">
                            <div class="skill-card-icon">üß†</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">prime</div>
                                <div class="skill-card-desc">Deep codebase understanding</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/plan-feature" onclick="toggleSkill('/plan-feature')">
                            <div class="skill-card-icon">üìã</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">plan-feature</div>
                                <div class="skill-card-desc">Feature plan with analysis</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/orchestrate" onclick="toggleSkill('/orchestrate')">
                            <div class="skill-card-icon">ü§ñ</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">orchestrate</div>
                                <div class="skill-card-desc">Multi-agent task decomposition</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                    </div>
                </div>

                <!-- Development -->
                <div class="skills-section">
                    <div class="skills-section-title">üíª Development</div>
                    <div class="skills-grid">
                        <div class="skill-card" data-skill="/refactor" onclick="toggleSkill('/refactor')">
                            <div class="skill-card-icon">üîß</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">refactor</div>
                                <div class="skill-card-desc">Dead code, patterns, optimization</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/debug-trace" onclick="toggleSkill('/debug-trace')">
                            <div class="skill-card-icon">üêõ</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">debug-trace</div>
                                <div class="skill-card-desc">Systematic debugging</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/explain" onclick="toggleSkill('/explain')">
                            <div class="skill-card-icon">üîç</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">explain</div>
                                <div class="skill-card-desc">Analyze before coding</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/frontend-design" onclick="toggleSkill('/frontend-design')">
                            <div class="skill-card-icon">üé®</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">frontend-design</div>
                                <div class="skill-card-desc">Production-grade UI</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/playground" onclick="toggleSkill('/playground')">
                            <div class="skill-card-icon">üéÆ</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">playground</div>
                                <div class="skill-card-desc">Interactive HTML explorer</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/discover-stack" onclick="toggleSkill('/discover-stack')">
                            <div class="skill-card-icon">üîé</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">discover-stack</div>
                                <div class="skill-card-desc">Detect tech stack</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                    </div>
                </div>

                <!-- Testing & Quality -->
                <div class="skills-section">
                    <div class="skills-section-title">‚úÖ Testing & Quality</div>
                    <div class="skills-grid">
                        <div class="skill-card" data-skill="/generate-tests" onclick="toggleSkill('/generate-tests')">
                            <div class="skill-card-icon">üß™</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">generate-tests</div>
                                <div class="skill-card-desc">Auto-generate tests</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/code-review" onclick="toggleSkill('/code-review')">
                            <div class="skill-card-icon">üëÄ</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">code-review</div>
                                <div class="skill-card-desc">Multi-agent review</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/validate" onclick="toggleSkill('/validate')">
                            <div class="skill-card-icon">‚úì</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">validate</div>
                                <div class="skill-card-desc">Run validation suite</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/preflight" onclick="toggleSkill('/preflight')">
                            <div class="skill-card-icon">üõ´</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">preflight</div>
                                <div class="skill-card-desc">Pre-deployment checks</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/analyze-code" onclick="toggleSkill('/analyze-code')">
                            <div class="skill-card-icon">üìä</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">analyze-code</div>
                                <div class="skill-card-desc">Complexity & tech debt</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/code-review-fix" onclick="toggleSkill('/code-review-fix')">
                            <div class="skill-card-icon">üîß</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">code-review-fix</div>
                                <div class="skill-card-desc">Fix review findings</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                    </div>
                </div>

                <!-- Security -->
                <div class="skills-section">
                    <div class="skills-section-title">üîí Security</div>
                    <div class="skills-grid">
                        <div class="skill-card" data-skill="/security-scan" onclick="toggleSkill('/security-scan')">
                            <div class="skill-card-icon">üõ°Ô∏è</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">security-scan</div>
                                <div class="skill-card-desc">OWASP, CVE, secrets</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/security-check" onclick="toggleSkill('/security-check')">
                            <div class="skill-card-icon">üîí</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">security-check</div>
                                <div class="skill-card-desc">Vulnerability review</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                    </div>
                </div>

                <!-- Git & Workflow -->
                <div class="skills-section">
                    <div class="skills-section-title">üîÑ Git & Workflow</div>
                    <div class="skills-grid">
                        <div class="skill-card" data-skill="/commit" onclick="toggleSkill('/commit')">
                            <div class="skill-card-icon">üì¶</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">commit</div>
                                <div class="skill-card-desc">Git commit & push</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/build-pipeline" onclick="toggleSkill('/build-pipeline')">
                            <div class="skill-card-icon">üöÄ</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">build-pipeline</div>
                                <div class="skill-card-desc">CI/CD config generator</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/execution-report" onclick="toggleSkill('/execution-report')">
                            <div class="skill-card-icon">üìã</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">execution-report</div>
                                <div class="skill-card-desc">Implementation report</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/system-review" onclick="toggleSkill('/system-review')">
                            <div class="skill-card-icon">üìä</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">system-review</div>
                                <div class="skill-card-desc">Implementation vs plan</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                    </div>
                </div>

                <!-- Documentation -->
                <div class="skills-section">
                    <div class="skills-section-title">üìö Documentation</div>
                    <div class="skills-grid">
                        <div class="skill-card" data-skill="/create-prd" onclick="toggleSkill('/create-prd')">
                            <div class="skill-card-icon">üìÑ</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">create-prd</div>
                                <div class="skill-card-desc">Product requirements doc</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/adr" onclick="toggleSkill('/adr')">
                            <div class="skill-card-icon">üìê</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">adr</div>
                                <div class="skill-card-desc">Architecture decision record</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/revise-claude-md" onclick="toggleSkill('/revise-claude-md')">
                            <div class="skill-card-icon">üìö</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">revise-claude-md</div>
                                <div class="skill-card-desc">Update CLAUDE.md</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/claude-md-improver" onclick="toggleSkill('/claude-md-improver')">
                            <div class="skill-card-icon">üìù</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">claude-md-improver</div>
                                <div class="skill-card-desc">Audit CLAUDE.md quality</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                    </div>
                </div>

                <!-- GitHub -->
                <div class="skills-section">
                    <div class="skills-section-title">üêô GitHub</div>
                    <div class="skills-grid">
                        <div class="skill-card" data-skill="/github_bug_fix:rca" onclick="toggleSkill('/github_bug_fix:rca')">
                            <div class="skill-card-icon">üîç</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">github:rca</div>
                                <div class="skill-card-desc">Root cause analysis</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/github_bug_fix:implement-fix" onclick="toggleSkill('/github_bug_fix:implement-fix')">
                            <div class="skill-card-icon">üîß</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">github:fix</div>
                                <div class="skill-card-desc">Implement from RCA</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                    </div>
                </div>

                <!-- Utilities -->
                <div class="skills-section">
                    <div class="skills-section-title">üõ†Ô∏è Utilities</div>
                    <div class="skills-grid">
                        <div class="skill-card" data-skill="/help" onclick="toggleSkill('/help')">
                            <div class="skill-card-icon">‚ùì</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">help</div>
                                <div class="skill-card-desc">Show all commands</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/init-project" onclick="toggleSkill('/init-project')">
                            <div class="skill-card-icon">üöÄ</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">init-project</div>
                                <div class="skill-card-desc">Initialize new project</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/keybindings-help" onclick="toggleSkill('/keybindings-help')">
                            <div class="skill-card-icon">‚å®Ô∏è</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">keybindings</div>
                                <div class="skill-card-desc">Customize shortcuts</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                        <div class="skill-card" data-skill="/viewtask" onclick="toggleSkill('/viewtask')">
                            <div class="skill-card-icon">üìù</div>
                            <div class="skill-card-info">
                                <div class="skill-card-name">viewtask</div>
                                <div class="skill-card-desc">View TASK.md</div>
                            </div>
                            <div class="skill-card-check"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job History Modal -->
        <div id="jobHistoryModal" class="modal-overlay" style="display:none;">
            <div class="modal-content job-history-modal">
                <div class="modal-header">
                    <h3>Job History</h3>
                    <button class="modal-close" onclick="closeJobHistoryModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="job-history-filters">
                        <select id="jobHistoryProjectFilter" onchange="loadJobHistory()">
                            <option value="">All Projects</option>
                        </select>
                        <select id="jobHistoryStatusFilter" onchange="loadJobHistory()">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="processing">Processing</option>
                            <option value="completed">Completed</option>
                            <option value="failed">Failed</option>
                        </select>
                    </div>
                    <div class="job-history-list" id="jobHistoryList">
                        <div class="job-history-loading">Loading job history...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Skill Info Modal -->
        <div id="skillInfoOverlay" class="skill-info-overlay" onclick="closeSkillInfo()" style="display:none;"></div>
        <div id="skillInfoModal" class="skill-info-modal" style="display:none;">
            <div class="skill-info-header">
                <div class="skill-info-title">
                    <span class="skill-info-icon" id="skillInfoIcon"></span>
                    <span id="skillInfoName"></span>
                </div>
                <button class="skill-info-close" onclick="closeSkillInfo()">&times;</button>
            </div>
            <div class="skill-info-content">
                <div class="skill-info-loading" id="skillInfoLoading">
                    <span class="skill-info-spinner"></span>
                    Loading skill information...
                </div>
                <div id="skillInfoBody" style="display:none;">
                    <div class="skill-info-section">
                        <div class="skill-info-label">Description</div>
                        <div class="skill-info-text" id="skillInfoDesc"></div>
                    </div>
                    <div class="skill-info-section" id="skillInfoOverviewSection" style="display:none;">
                        <div class="skill-info-label">Overview</div>
                        <div class="skill-info-text" id="skillInfoOverview"></div>
                    </div>
                    <div class="skill-info-section">
                        <div class="skill-info-label">Usage</div>
                        <div class="skill-info-code" id="skillInfoUsage"></div>
                    </div>
                    <div class="skill-info-section" id="skillInfoExamplesSection" style="display:none;">
                        <div class="skill-info-label">Examples</div>
                        <div class="skill-info-examples" id="skillInfoExamples"></div>
                    </div>
                    <div class="skill-info-section" id="skillInfoContentSection" style="display:none;">
                        <div class="skill-info-label">Full Documentation</div>
                        <div class="skill-info-markdown" id="skillInfoFullContent"></div>
                    </div>
                    <div class="skill-info-actions">
                        <button class="skill-info-use-btn" id="skillInfoUseBtn" onclick="useSkillFromInfo()">
                            Use This Skill
                        </button>
                        <button class="skill-info-copy-btn" onclick="copySkillCommand()">
                            Copy Command
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>{{JS_PLACEHOLDER}}</script>
</body>
</html>
